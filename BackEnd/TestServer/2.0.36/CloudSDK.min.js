/* Ver: 2.0.36 (Date build: 180305) */

window.Log=function(e){var o=this;o.mElementID=e,o.el=document.getElementById(e),o.el&&(o.el.innerHTML='<div class="logger-line">Start</div>'),o.escape=function(e){if(e===void 0)return"undefined";"object"==typeof e&&(e=JSON.stringify(e));var o=e,r=[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/"/g,"&quot;"]];for(var t in r)o=o.replace(r[t][0],r[t][1]);return o},o.info=function(e){console.log(e),o.el&&(o.el.innerHTML+='<div class="logger-line info">'+o.escape(e)+"</div>")},o.error=function(e){console.error(e),o.el&&(o.el.innerHTML+='<div class="logger-line error">'+o.escape(e)+"</div>")},o.warn=function(e){console.warn(e),o.el&&(o.el.innerHTML+='<div class="logger-line warn">'+o.escape(e)+"</div>")}},window.CloudHelpers=window.CloudHelpers||{},CloudHelpers.parseUri=function(e){var o={};o.source=e;var r=e.split("/");o.protocol=r[0],o.protocol=o.protocol.slice(0,o.protocol.length-1),o.protocol=o.protocol.toLowerCase();var t=r[2];if(!t)return o;o.path="/"+r.slice(3).join("/");var n=RegExp(".*:(\\d+)$","g"),a=n.exec(t);if(a&&a.length>1&&(o.port=parseInt(a[1],10),t=t.slice(0,t.length-a[1].length-1)),-1==t.indexOf(":")&&-1==t.indexOf("@"))o.host=t,t="";else{var l=t.split("@");o.host=l[l.length-1],t=t.slice(0,t.length-o.host.length-1)}if(""!=t)if(-1!=t.indexOf(":")){var i=t.split(":");o.user=i[0],o.password=i[1]}else o.user=t,t="";return o},CloudHelpers.parseUriTests=function(){function e(e,o,r){o!=r?console.error("Expected value "+r+", but got "+o+" in url "+e):console.log("OK")}var o=[{url:"rtsp://aaa12:hjh@1111@100.224.0.117:1024/live/strm/tracks/601?starttime=20160616T191653Z",protocol:"rtsp",port:1024,host:"100.224.0.117",user:"aaa12",password:"hjh@1111"},{url:"rtsp://100.224.0.117/live/strm/tracks/601?starttime=20160616T191653Z",host:"100.224.0.117",protocol:"rtsp"},{url:"rtsp://184.72.239.149/vod/mp4:BigBuckBunny_115k.mov",host:"184.72.239.149",protocol:"rtsp"}];for(var r in o){var t=o[r],n=CloudHelpers.parseUri(t.url);e(t.url,n.protocol,t.protocol),e(t.url,n.port,t.port),e(t.url,n.host,t.host),e(t.url,n.user,t.user),e(t.url,n.password,t.password)}},CloudHelpers.promise=function(){var e={};return e.completed=!1,e.failed=!1,e.successed=!1,e.done=function(o){return e.done_callback=o,e.completed&&"function"==typeof e.done_callback&&e.successed&&e.done_callback.apply(this,e.result_arguments),e},e.fail=function(o){return e.fail_callback=o,e.completed&&"function"==typeof e.fail_callback&&e.failed&&e.fail_callback.apply(this,e.error_arguments),e},e.resolve=function(){e.completed||(e.result_arguments=arguments,"function"==typeof e.done_callback&&e.done_callback.apply(this,e.result_arguments)),e.successed=!0,e.completed=!0},e.reject=function(){e.completed||(e.error_arguments=arguments,"function"==typeof e.fail_callback&&e.fail_callback.apply(this,e.error_arguments)),e.failed=!0,e.completed=!0},e},CloudHelpers.waitPromises=function(e){function o(e){n.push(e),n.length==t&&r.resolve(n)}var r=CloudHelpers.promise(),t=e.length,n=[];for(var a in e)e[a].done(o).fail(o);return r},CloudHelpers.request=function(e){var o=CloudHelpers.promise(),r="onload"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest;return r.open(e.type,e.url,!0),e.contentType&&r.setRequestHeader("Content-Type",e.contentType),e.token&&r.setRequestHeader("Authorization","SkyVR "+e.token),r.onload=function(){var e="";if(""!=this.responseText)try{e=JSON.parse(this.responseText)}catch(t){return console.error(t),o.reject(CloudReturnCode.ERROR_WRONG_RESPONSE),void 0}var n=this.status;n>=200&&300>n?o.resolve(e):o.reject(e),delete r},r.onerror=function(){o.reject(r),delete r},e.data?r.send(e.data):r.send(),o},CloudHelpers.handleError=function(e,o,r){e.errorDetail&&404==e.status?o.reject(CloudReturnCode.ERROR_NOT_FOUND):e.errorDetail&&401==e.status?o.reject(CloudReturnCode.ERROR_NOT_AUTHORIZED):r?r(e,o):o.reject(e)},CloudHelpers.requestAsyncList=function(e,o,r){var t={meta:{limit:1e3,offset:0,total_count:-1},objects:[]};o.limit=t.meta.limit,o.offset=t.meta.offset,e(o).fail(function(e){r.reject(e)}).done(function(n){if(t.meta.total_count=n.meta.total_count,t.objects=t.objects.concat(n.objects),n.meta.offset+n.objects.length>=n.meta.total_count)r.resolve(t);else{for(var a=[],l=t.meta.limit;t.meta.total_count>l;l+=t.meta.limit)o.offset=l,a.push(e(o));CloudHelpers.waitPromises(a).done(function(e){for(var o=0;e.length>o;o++)t.objects=t.objects.concat(e[o].objects);r.resolve(t)}).fail(function(e){r.reject(e)})}})},CloudHelpers.flashVersion=void 0,CloudHelpers.getFlashVersion=function(){try{try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{e.AllowScriptAccess="always"}catch(o){return"6,0,0"}}catch(o){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(o){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(o){}}return"0,0,0"},CloudHelpers.supportFlash=function(){return CloudHelpers.flashVersion||(CloudHelpers.flashVersion=CloudHelpers.getFlashVersion()),"0,0,0"!=CloudHelpers.flashVersion},CloudHelpers.useHls=function(){return CloudHelpers.isMobile()||!CloudHelpers.supportFlash()||CloudHelpers.containsPageParam("hls")},CloudHelpers.mapToUrlQuery=function(e){if(!e)return"";var o=[];for(var r in e)o.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return o.join("&")},CloudHelpers.lang=function(){return CloudHelpers.sLang||CloudHelpers.locale()},CloudHelpers.locale=function(){if(langs=["en","ko","ru"],CloudHelpers.sLang="en",CloudHelpers.containsPageParam("lang")&&langs.indexOf(CloudHelpers.pageParams.lang)>=-1)CloudHelpers.sLang=CloudHelpers.pageParams.lang;else if(navigator){var e="en";e=navigator.language?navigator.language.substring(0,2):e,e=navigator.browserLanguage?navigator.browserLanguage.substring(0,2):e,e=navigator.systemLanguage?navigator.systemLanguage.substring(0,2):e,e=navigator.userLanguage?navigator.userLanguage.substring(0,2):e,langs.indexOf(e)>=-1?CloudHelpers.sLang=e:console.warn("Unsupported lang "+e+", will be used default lang: "+CloudHelpers.sLang),CloudHelpers.sLang=langs.indexOf(e)>=-1?e:CloudHelpers.sLang}else CloudHelpers.sLang="en";return CloudHelpers.sLang},CloudHelpers.parsePageParams=function(){for(var e=window.location.search.slice(1),o=e.split("&"),r={},t=RegExp("(.*)=([^&#]*)"),n=0;o.length>n;n++)""!=o[n].trim()&&(p=t.exec(o[n].trim()),null==p?r[decodeURIComponent(o[n].trim().replace(/\+/g," "))]="":r[decodeURIComponent(p[1].replace(/\+/g," "))]=decodeURIComponent(p[2].replace(/\+/g," ")));return r},CloudHelpers.pageParams=CloudHelpers.parsePageParams(),CloudHelpers.containsPageParam=function(e){return CloudHelpers.pageParams[e]!==void 0},CloudHelpers.keepParams=["lang","url","fcno","vendor","demo","messaging","hls","svcp_host","backwardDeactivateAfter","mobile","experimental_hls","page_id","preview","customswf"],CloudHelpers.changeLocationState=function(e){var o=[];for(var r in CloudHelpers.keepParams){var t=CloudHelpers.keepParams[r];CloudHelpers.containsPageParam(t)&&o.push(t+"="+encodeURIComponent(CloudHelpers.pageParams[t]))}for(var n in e)o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));var a=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+o.join("&");try{window.history.pushState?window.history.pushState(e,document.title,a):console.error("window.history.pushState - function not found")}catch(l){console.error("changeLocationState: Could not change location to "+a)}CloudHelpers.pagePwindow.btoa("Hello, world"),arams=CloudHelpers.parsePageParams()},CloudHelpers.osname=function(){var e="unknown";return-1!=navigator.appVersion.indexOf("Win")&&(e="win"),-1!=navigator.appVersion.indexOf("Mac")&&(e="mac"),-1!=navigator.appVersion.indexOf("X11")&&(e="unix"),-1!=navigator.appVersion.indexOf("Linux")&&(e="linux"),e},CloudHelpers.isSafari=function(){var e=window.navigator.userAgent.toLowerCase().indexOf("chrome")>-1,o=window.navigator.userAgent.toLowerCase().indexOf("safari")>-1;return!e&&o},CloudHelpers.isEdge=function(){return window.navigator.userAgent.indexOf("Edge")>-1},CloudHelpers.isMobile=function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1},CloudHelpers.isIpV4=function(e){return null!=e.match(/^([0-9]{1,3}\.){3}[0-9]{1,3}/)},CloudHelpers.parseUTCTime=function(e){e=e.replace(RegExp("-","g")," "),e=e.replace(RegExp("T","g")," "),e=e.replace(RegExp(":","g")," ");var o=e.split(" "),r=new Date;r.setUTCFullYear(parseInt(o[0],10)),r.setUTCMonth(parseInt(o[1],10)-1),r.setUTCDate(parseInt(o[2],10)),r.setUTCHours(parseInt(o[3],10)),r.setUTCMinutes(parseInt(o[4],10)),r.setUTCSeconds(parseInt(o[5],10));var t=r.getTime();return t-=t%1e3},CloudHelpers.formatUTCTime=function(e){var o=new Date;o.setTime(e);var r=o.getUTCFullYear()+"-"+("00"+(o.getUTCMonth()+1)).slice(-2)+"-"+("00"+o.getUTCDate()).slice(-2)+"T"+("00"+o.getUTCHours()).slice(-2)+":"+("00"+o.getUTCMinutes()).slice(-2)+":"+("00"+o.getUTCSeconds()).slice(-2);return r},CloudHelpers.ONE_SECOND=1e3,CloudHelpers.ONE_MINUTE=6e4,CloudHelpers.ONE_HOUR=36e5,CloudHelpers.getCurrentTimeUTC=function(){return Date.now()},CloudHelpers.isLocalFile=function(){return"https:"!=window.location.protocol&&"http:"!=window.location.protocol},CloudHelpers.combineURL=function(e,o,r){""==o&&(o=void 0),""==r&&(r=void 0);var t=CloudHelpers.parseUri(e),n=t.protocol+"://";return(o||r)&&(n+=o,r&&(n+=":"+r),n+="@"),n+=t.host+(""!=t.port?":"+t.port:"")+t.path},CloudHelpers.validIpV4=function(e){for(var o=e.split("."),r=0;4>r;r++){var t=parseInt(o[r],10);if(0>t||t>255)return!1}return!0},CloudHelpers.convertIpV4ToInt=function(e){for(var o=e.split("."),r=0,t=1,n=3;n>=0;n--)r+=parseInt(o[n],10)*t,t=256*t;return r},CloudHelpers.isValidHostID=function(e){var o=CloudHelpers.parseUri(e);return"localhost"==o.host?!0:CloudHelpers.isIpV4(o.host)&&!CloudHelpers.validIpV4(o.host)?(console.error("Address "+o.host+" - invalid address"),!1):!0},CloudHelpers.isLocalUrlOrIP=function(e){var o=CloudHelpers.parseUri(e);if("localhost"==o.host)return!0;if(CloudHelpers.isIpV4(o.host)){if(!CloudHelpers.validIpV4(o.host))return console.error("Address "+o.host+" - invalid address"),!0;var r=CloudHelpers.convertIpV4ToInt(o.host),t=[];t.push({from:"127.0.0.0",to:"127.255.255.255",comment:"localhost addresses"});for(var n in t){var a=CloudHelpers.convertIpV4ToInt(t[n].from),l=CloudHelpers.convertIpV4ToInt(t[n].to),i=t[n].comment;if(r>=a&&l>=r)return console.error(i),!0}}return!1},CloudHelpers.isPublicUrl=function(e){var o=CloudHelpers.parseUri(e);if("localhost"==o.host)return!1;if(CloudHelpers.isIpV4(o.host)){if(!CloudHelpers.validIpV4(o.host))return console.error("Address "+o.host+" - invalid address"),!1;var r=CloudHelpers.convertIpV4ToInt(o.host),t=[];t.push({from:"10.0.0.0",to:"10.255.255.255",comment:"single class A network"}),t.push({from:"172.16.0.0",to:"172.31.255.255",comment:"16 contiguous class B network"}),t.push({from:"192.168.0.0",to:"192.168.255.255",comment:"256 contiguous class C network"}),t.push({from:"169.254.0.0",to:"169.254.255.255",comment:"Link-local address also refered to as Automatic Private IP Addressing"}),t.push({from:"127.0.0.0",to:"127.255.255.255",comment:"localhost addresses"});for(var n in t){var a=CloudHelpers.convertIpV4ToInt(t[n].from),l=CloudHelpers.convertIpV4ToInt(t[n].to),i=t[n].comment;if(r>=a&&l>=r)return console.error(i),!1}}return!0},CloudHelpers.isFireFox=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},CloudHelpers.isAndroid=function(){return navigator.userAgent.match(/Android/i)?!0:!1},CloudHelpers.isIOS=function(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)?!0:!1},CloudHelpers.isWindowsPhone=function(){return navigator.userAgent.match(/Windows Phone/i)?!0:!1},CloudHelpers.isBlackBerry=function(){return navigator.userAgent.match(/BlackBerry/i)?!0:!1},CloudHelpers.splitUserInfoFromURL=function(e){var o=CloudHelpers.parseUri(e),r=o.protocol+"://"+o.host+(o.port?":"+o.port:"")+o.path,t=o.user,n=o.password;return{url:r,login:t,password:n}},CloudHelpers.getAbsolutePosition=function(e){var o={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var r=CloudHelpers.getAbsolutePosition(e.offsetParent);o.x+=r.x,o.y+=r.y}return o},CloudHelpers.cache=CloudHelpers.cache||{},CloudHelpers.cache.timezones=CloudHelpers.cache.timezones||{},CloudHelpers.getOffsetTimezone=function(e){if(!moment)return console.warn("Requrired moment.js library"),0;if(void 0==CloudHelpers.cache.timezones[e]){var o=new Date;if(e&&""!=e){var r=moment(o).tz(e).format("Z"),t=r[0];("0">t||t>"9")&&(r=r.substring(1));var n="-"==t?-1:1,a=r.split(":");r=n*(60*parseInt(a[0],10)+parseInt(a[1],10)),CloudHelpers.cache.timezones[e]=6e4*r}else CloudHelpers.cache.timezones[e]=0}return CloudHelpers.cache.timezones[e]},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},CloudHelpers.autoPlayAllowed=!0,CloudHelpers.checkAutoplay=function(){var e=document.createElement("video").play(),o=window.Promise;void 0!=o&&e instanceof Promise&&e.catch(function(e){if(console.error(e),"NotAllowedError"!=e.name)throw e;CloudHelpers.autoPlayAllowed=!1}).then(function(){CloudHelpers.autoPlayAllowed})},CloudHelpers.checkAutoplay(),CloudHelpers.humanFileSize=function(e){var o=1024;if(o>e)return e+" B";var r=["kB","MB","GB","TB","PB","EB","ZB","YB"],t=-1;do e/=o,++t;while(e>=o);return e.toFixed(1)+" "+r[t]},CloudHelpers.base64_encode=function(e){return window.btoa(e)},CloudHelpers.base64_decode=function(e){return window.atob(e)},CloudHelpers.copy=function(e){if(null==e||"object"!=typeof e)return console.error("Expected object"),e;var o=e.constructor();for(var r in e)e.hasOwnProperty(r)&&(o[r]=e[r]);return o},window.CloudAPI=function(e,o){var r=this;r.token=e.token,r.token_expire=e.expire,r.token_expireUTC=Date.parse(e.expire+"Z"),r.host=o,r.token_type=e.type,r.isShareToken=function(){return"share"==r.token_type},r.endpoints={api:r.host+"api/v2/",cameras:r.host+"api/v2/cameras/",admin_cameras:r.host+"api/v2/admin/cameras/",camsess:r.host+"api/v2/camsess/",server:r.host+"api/v2/server/",account:r.host+"api/v2/account/",cmngrs:r.host+"api/v2/cmngrs/",storage:r.host+"api/v2/storage/",clips:r.host+"api/v2/storage/clips/",channels:r.host+"api/v3/channels/"},r._getCloudToken=function(){return r.token},r.updateApiToken=function(){return CloudHelpers.request({url:r.endpoints.account+"token/api/",type:"GET",token:r._getCloudToken()})},r.isShareToken()||r.updateApiToken().done(function(e){console.warn("[CloudConnection] Cloud Token Api refreshed"),r.token=e.token,r.token_expire=e.expire,r.token_expireUTC=Date.parse(e.expire+"Z"),clearInterval(r.updateTokenInterval),r.updateTokenInterval=setInterval(function(){12e5>r.token_expireUTC-(new Date).getTime()?r.updateApiToken().done(function(e){console.warn("[CloudConnection] Cloud Token api refreshed"),r.token=e.token,r.token_expire=e.expire,r.token_expireUTC=Date.parse(e.expire+"Z")}):console.log("[CloudConnection] Cloud Token is live")},3e5)}),r.dispose=function(){r.token=null,clearInterval(r.updateTokenInterval)},r.createCamera=function(e){return CloudHelpers.request({url:r.endpoints.cameras+"?detail=detail",type:"POST",token:r._getCloudToken(),data:JSON.stringify(e),contentType:"application/json"})},r.camerasList=function(e){e=e||{},r.isShareToken()&&(e.token=r._getCloudToken());var o=CloudHelpers.mapToUrlQuery(e);return CloudHelpers.request({url:r.endpoints.cameras+"?"+o,type:"GET",token:r._getCloudToken(),contentType:"application/json"})},r.getCameraList=r.camerasList,r.deleteCamera=function(e){return CloudHelpers.request({url:r.endpoints.cameras+e+"/",type:"DELETE",token:r._getCloudToken()})},r.getCamera=function(e){var o={};r.isShareToken()&&(o.token=r._getCloudToken());var t=CloudHelpers.mapToUrlQuery(o);return CloudHelpers.request({url:r.endpoints.cameras+e+"/?detail=detail&"+t,type:"GET",token:r._getCloudToken()})},r.cameraUsage=function(e){return CloudHelpers.request({url:r.endpoints.cameras+e+"/usage/",type:"GET",token:r._getCloudToken()})},r.updateCamera=function(e,o){return CloudHelpers.request({url:r.endpoints.cameras+e+"/?detail=detail",type:"PUT",token:r._getCloudToken(),data:JSON.stringify(o),contentType:"application/json"})},r.cameraLiveUrls=function(e){var o={};r.isShareToken()&&(o.token=r._getCloudToken());var t=CloudHelpers.mapToUrlQuery(o);return CloudHelpers.request({url:r.endpoints.cameras+e+"/live_urls/?"+t,type:"GET",token:r._getCloudToken(),data:JSON.stringify(o)})},r.getServerTime=function(){var e=CloudHelpers.promise();return CloudHelpers.request({url:r.endpoints.api+"server/time/",type:"GET"}).done(function(o){var t=CloudHelpers.getCurrentTimeUTC();r.diffServerTime=Date.parse(o.utc+"Z")-t,e.resolve(o)}).fail(function(o){e.reject(o)}),e},r.getAccountInfo=function(){return CloudHelpers.request({url:r.endpoints.account,type:"GET",token:r._getCloudToken()})},r.getAccountCapabilities=function(){return CloudHelpers.request({url:r.endpoints.account+"capabilities/",type:"GET",token:r._getCloudToken()})},r.cameraMediaStreams=function(e){return CloudHelpers.request({url:r.endpoints.cameras+e+"/media_streams/",type:"GET",token:r._getCloudToken()})},r.updateCameraMediaStreams=function(e,o){return CloudHelpers.request({url:r.endpoints.cameras+e+"/media_streams/",type:"PUT",data:JSON.stringify(o),contentType:"application/json",token:r._getCloudToken()})},r.cameraPreview=function(e){var o={};r.isShareToken()&&(o.token=r._getCloudToken());var t=CloudHelpers.mapToUrlQuery(o);return CloudHelpers.request({url:r.endpoints.cameras+e+"/preview/?"+t,type:"GET",token:r._getCloudToken()})},r.cameraUpdatePreview=function(e){return CloudHelpers.request({url:r.endpoints.cameras+e+"/preview/update/",type:"POST",token:r._getCloudToken()})},r.storageRecords=function(e,o,t){function n(e){var o=CloudHelpers.mapToUrlQuery(e);return CloudHelpers.request({url:r.endpoints.storage+"data/?"+o,type:"GET",token:r._getCloudToken()})}var a=CloudHelpers.promise(),l={camid:e,limit:1e3,offset:0,start:o};return t&&(l.end=t),r.isShareToken()&&(l.token=r._getCloudToken()),CloudHelpers.requestAsyncList(n,l,a),a},r.storageRecordsFirst=function(e,o,t){CloudHelpers.promise();var n={camid:e,limit:t,offset:0,start:o};n.limit=t,r.isShareToken()&&(n.token=r._getCloudToken());var a=CloudHelpers.mapToUrlQuery(n);return CloudHelpers.request({url:r.endpoints.storage+"data/?"+a,type:"GET",token:r._getCloudToken()})},r.storageTimeline=function(e,o,t,n){var a={start:o,end:t,slices:n};r.isShareToken()&&(a.token=r._getCloudToken());var l=CloudHelpers.mapToUrlQuery(a);return CloudHelpers.request({url:r.endpoints.storage+"timeline/"+e+"/?"+l,type:"GET",token:r._getCloudToken()})},r.storageActivity=function(e,o){var t={camid:e};o&&(t.daysincamtz="");var n=CloudHelpers.mapToUrlQuery(t);return CloudHelpers.request({url:r.endpoints.storage+"activity/?"+n,type:"GET",token:r._getCloudToken()})},r.resetCameraManager=function(e,o){return r.isShareToken()?(o=o||{},CloudHelpers.request({url:r.endpoints.cmngrs+e+"/reset/?token="+r._getCloudToken(),type:"POST",data:JSON.stringify(o),contentType:"application/json"})):(o=o||{},CloudHelpers.request({url:r.endpoints.cmngrs+e+"/reset/",type:"POST",token:r._getCloudToken(),data:JSON.stringify(o),contentType:"application/json"}))},r.updateCameraManager=function(e,o){return o=o||{},CloudHelpers.request({url:r.endpoints.cmngrs+e+"/",type:"PUT",token:r._getCloudToken(),data:JSON.stringify(o),contentType:"application/json"})},r.getCamsessList=function(e){var o=CloudHelpers.mapToUrlQuery(e);return CloudHelpers.request({url:r.endpoints.camsess+"?"+o,type:"GET",token:r._getCloudToken(),contentType:"application/json"})},r.getCamsess=function(e){return CloudHelpers.request({url:r.endpoints.camsess+e+"/?detail=detail",type:"GET",token:r._getCloudToken(),contentType:"application/json"})},r.getCamsessRecords=function(e){return CloudHelpers.request({url:r.endpoints.camsess+e+"/records/",type:"GET",token:r._getCloudToken(),contentType:"application/json"})},r.deleteCamsess=function(e){return CloudHelpers.request({url:r.endpoints.camsess+e+"/",type:"DELETE",token:r._getCloudToken()})},r.creareCameraSharingToken=function(e,o,t){return o=o||"",CloudHelpers.request({url:r.endpoints.cameras+e+"/sharings/",type:"POST",data:JSON.stringify({camid:e,name:o,access:t}),contentType:"application/json",token:r._getCloudToken()})},r.updateCameraSharingToken=function(e,o,t){return t=t||{},t.camid=e,t.shid=o,CloudHelpers.request({url:r.endpoints.cameras+e+"/sharings/"+o+"/",type:"PUT",data:JSON.stringify(t),contentType:"application/json",token:r._getCloudToken()})},r.getCameraSharingTokensList=function(e){return CloudHelpers.request({url:r.endpoints.cameras+e+"/sharings/?detail=detail",type:"GET",token:r._getCloudToken()})},r.deleteCameraSharingToken=function(e,o){return CloudHelpers.request({url:r.endpoints.cameras+e+"/sharings/"+o+"/",type:"DELETE",token:r._getCloudToken()})},r.getChannels=function(){return CloudHelpers.request({url:r.endpoints.channels,type:"GET",token:r._getCloudToken()})}},window.SkyVR=window.CloudAPI,CloudAPI.config={url:"",url_cameras:"",url_api:"",cameraID:"",user_name:"",vendor:""},CloudAPI.setToCookie=function(e,o){var r=new Date((new Date).getTime()+6048e5);document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(o)+"; path=/; expires="+r.toUTCString()},CloudAPI.getFromCookie=function(e){var o=document.cookie.match(RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return o?decodeURIComponent(o[1]):""},CloudAPI.removeFromCookie=function(e){document.cookie=encodeURIComponent(e)+"=; path=/;"},CloudAPI.cache={cameras:{},timezones:{}},CloudAPI.cache.cameraInfo=function(e){return e?CloudAPI.cache.cameras[e]:CloudAPI.isCameraID()?CloudAPI.cache.cameras[CloudAPI.cameraID()]:void 0},CloudAPI.cache.getCameraInfo=CloudAPI.cache.cameraInfo,CloudAPI.cache.mergeObjects=function(e,o){for(var r in o){var t=typeof o[r];"boolean"==t||"string"==t||"number"==t?e[r]!=o[r]&&(e[r]&&(console.log("Changed "+r),CloudAPI.events.trigger("CAMERA_INFO_CHANGED",{name:r,new_value:o[r]})),e[r]=o[r]):Array.isArray(o[r])?e[r]=o[r]:"object"==t&&(e[r]||(e[r]={}),e[r]=CloudAPI.cache.mergeObjects(e[r],o[r]))}return e},CloudAPI.cache.updateCameraInfo=function(e){var o=e.id;CloudAPI.cache.cameras[o]||(CloudAPI.cache.cameras[o]={}),CloudAPI.cache.cameras[o]=CloudAPI.cache.mergeObjects(CloudAPI.cache.cameras[o],e)},CloudAPI.cache.setCameraInfo=function(e){var o=e.id;void 0==CloudAPI.cache.cameras[o]&&(CloudAPI.cache.cameras[o]={});var r=e.p2p_streaming&&1==e.p2p_streaming?!0:!1,t=CloudAPI.cache.cameras[o];return CloudAPI.cache.cameras[o]=CloudAPI.cache.mergeObjects(t,e),CloudAPI.cache.cameras[o].lastTimeUpdated=Date.now(),r},CloudAPI.cache.setP2PSettings=function(e,o){void 0==CloudAPI.cache.cameras[e]&&(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].p2p=o,CloudAPI.cache.cameras[e].p2p_settings=CloudAPI.cache.cameras[e].p2p},CloudAPI.cache.setMemoryCard=function(e,o){void 0==CloudAPI.cache.cameras[e]&&(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].memory_card=o},CloudAPI.cache.setPtzCaps=function(e,o){void 0==CloudAPI.cache.cameras[e]&&(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].ptz=o},CloudAPI.cache.updateCameraAudio=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].audio||(CloudAPI.cache.cameras[e].audio={}),CloudAPI.cache.cameras[e].audio=CloudAPI.cache.mergeObjects(CloudAPI.cache.cameras[e].audio,o)},CloudAPI.cache.cameraAudio=function(e){return e=e||CloudAPI.cameraID(),CloudAPI.cache.cameras[e]?CloudAPI.cache.cameras[e].audio:{}},CloudAPI.cache.updateCameraVideo=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].video||(CloudAPI.cache.cameras[e].video={});var r=CloudAPI.cache.cameras[e].video;CloudAPI.cache.cameras[e].video=CloudAPI.cache.mergeObjects(r,o)},CloudAPI.cache.cameraVideo=function(e){return e=e||CloudAPI.cameraID(),CloudAPI.cache.cameras[e]?CloudAPI.cache.cameras[e].video:{}},CloudAPI.cache.cameraVideoStreamName=function(e){if(e=e||CloudAPI.cameraID(),!CloudAPI.cache.cameras[e])return{};var o=CloudAPI.cache.cameras[e].video;if(o.streams)for(var r in o.streams)return r},CloudAPI.cache.cameraVideoStreams=function(e){if(e=e||CloudAPI.cameraID(),!CloudAPI.cache.cameras[e])return{};var o=CloudAPI.cache.cameras[e].video;return o.streams?o.streams:void 0},CloudAPI.cache.setLimits=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].limits=o},CloudAPI.cache.updateCameraVideoStream=function(e,o,r){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].video||(CloudAPI.cache.cameras[e].video={}),CloudAPI.cache.cameras[e].video.streams||(CloudAPI.cache.cameras[e].video.streams={}),CloudAPI.cache.cameras[e].video.streams[o]||(CloudAPI.cache.cameras[e].video.streams[o]={});var t=CloudAPI.cache.cameras[e].video.streams[o];CloudAPI.cache.cameras[e].video.streams[o]=CloudAPI.cache.mergeObjects(t,r)},CloudAPI.cache.setAudioStream=function(e,o,r){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].audio||(CloudAPI.cache.cameras[e].audio={}),CloudAPI.cache.cameras[e].audio.streams||(CloudAPI.cache.cameras[e].audio.streams={}),CloudAPI.cache.cameras[e].audio.streams[o]=r},CloudAPI.cache.setMediaStreams=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].media_streams=o},CloudAPI.cache.updateEventProcessingEventsMotion=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].event_processing||(CloudAPI.cache.cameras[e].event_processing={}),CloudAPI.cache.cameras[e].event_processing.events||(CloudAPI.cache.cameras[e].event_processing.events={}),CloudAPI.cache.cameras[e].event_processing.events.motion||(CloudAPI.cache.cameras[e].event_processing.events.motion={});var r=CloudAPI.cache.cameras[e].event_processing.events.motion;CloudAPI.cache.cameras[e].event_processing.events.motion=CloudAPI.cache.mergeObjects(r,o)},CloudAPI.cache.updateCameraEventProcessingEventsSound=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].event_processing||(CloudAPI.cache.cameras[e].event_processing={}),CloudAPI.cache.cameras[e].event_processing.events||(CloudAPI.cache.cameras[e].event_processing.events={}),CloudAPI.cache.cameras[e].event_processing.events.sound||(CloudAPI.cache.cameras[e].event_processing.events.sound={});var r=CloudAPI.cache.cameras[e].event_processing.events.sound;CloudAPI.cache.cameras[e].event_processing.events.sound=CloudAPI.cache.mergeObjects(r,o)},CloudAPI.generateNewLocation=function(e){var o=[];return CloudHelpers.containsPageParam("lang")&&o.push("lang="+encodeURIComponent(CloudAPI.pageParams.lang)),CloudHelpers.containsPageParam("vendor")&&o.push("vendor="+encodeURIComponent(CloudAPI.pageParams.vendor)),CloudHelpers.containsPageParam("mobile")&&o.push("mobile="+encodeURIComponent(CloudAPI.pageParams.mobile)),o.push("p="+encodeURIComponent(e)),"?"+o.join("&")},CloudAPI.setURL=function(e){if(CloudAPI.config.url!=e){CloudAPI.config.url=e,CloudAPI.config.url_api=e+"api/v2/",CloudAPI.config.url_cameras=e+"api/v2/cameras/",CloudAPI.config.url_admin_cameras=e+"api/v2/admin/cameras/",CloudAPI.config.url_camsess=e+"api/v2/camsess/",CloudAPI.config.url_server=e+"api/v2/server/",CloudAPI.config.url_account=e+"api/v2/account/",CloudAPI.config.url_cmngrs=e+"api/v2/cmngrs/",CloudAPI.config.url_storage=e+"api/v2/storage/",CloudAPI.config.url_clips=e+"api/v2/storage/clips/",CloudAPI.config.anonToken={token:"",type:"anon",expire:"",expireTimeUTC:0},localStorage.getItem("SkyVR_anonToken")&&(CloudAPI.config.anonToken=JSON.parse(localStorage.getItem("SkyVR_anonToken"))),CloudAPI.config.apiToken={token:"",type:"api",expire:"",expireTimeUTC:0},CloudAPI.config.shareToken={};var o=CloudAPI.getFromStorage("SkyVR_apiToken");if(o){var r=JSON.parse(o);r.expireTimeUTC>Date.now()&&(CloudAPI.config.apiToken=r)}CloudAPI.setToStorage("CloudAPI_svcp_host",e)}},CloudAPI.isExpiredApiToken=function(){return CloudAPI.config.apiToken.expireTimeUTC?CloudAPI.config.apiToken.expireTimeUTC>Date.now()?!1:!0:!0},CloudAPI.applyApiToken=function(){$.ajaxSetup({crossDomain:!0,cache:!1,beforeSend:function(e){CloudAPI.config.apiToken&&CloudAPI.config.apiToken.token&&e.setRequestHeader("Authorization","SkyVR "+CloudAPI.config.apiToken.token)}})},CloudAPI.enable401handler=function(){},CloudAPI.disable401handler=function(){$.ajaxSetup({error:function(){}})},CloudAPI.printStack=function(){var e=Error();console.error(e.stack)},CloudAPI.PAGE_SIGNIN="signin",CloudAPI.hasAccess=function(e,o){if(SkyUI.isDemo())return!0;if(!e)return!1;if(!e.access)return!0;var r=!1;for(var t in e.access)e.access[t]==o&&(r=!0);return r},CloudAPI.hasAccessSettings=function(e){return SkyUI.isDemo()?!0:(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessMotionDetection=function(e){return SkyUI.isDemo()?!0:(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"all")||CloudAPI.hasAccess(e,"ptz"))},CloudAPI.hasAccessClips=function(e){return SkyUI.isDemo()?!0:(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"clipping")||CloudAPI.hasAccess(e,"clipplay")||CloudAPI.hasAccess(e,"watch")||CloudAPI.hasAccess(e,"cplay")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessLive=function(e){return SkyUI.isDemo()?!0:(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"ptz")||CloudAPI.hasAccess(e,"live")||CloudAPI.hasAccess(e,"watch")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessPlayback=function(e){return SkyUI.isDemo()?!0:(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"clipping")||CloudAPI.hasAccess(e,"play")||CloudAPI.hasAccess(e,"watch")||CloudAPI.hasAccess(e,"splay")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessMakeClip=function(e){return SkyUI.isDemo()?!0:(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"clipping")||CloudAPI.hasAccess(e,"all"))},CloudAPI.hasAccessBackAudio=function(e){return SkyUI.isDemo()?!0:(e=e||CloudAPI.cache.cameraInfo(),CloudAPI.hasAccess(e,"all")||CloudAPI.hasAccess(e,"backaudio"))},CloudAPI.handleNothing=function(){},CloudAPI.handleNothingError=function(){},CloudAPI.handleError=function(e,o,r){console.error(r)},CloudAPI.parseUri=function(e){function o(e){for(var r=o.options,t=r.parser[r.strictMode?"strict":"loose"].exec(e),n={},a=14;a--;)n[r.key[a]]=t[a]||"";return n[r.q.name]={},n[r.key[12]].replace(r.q.parser,function(e,o,t){o&&(n[r.q.name][o]=t)}),n}return o.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},o(e)},CloudAPI.logout=function(e){$.ajax({url:CloudAPI.config.url_account+"logout/",type:"POST",success:e,error:CloudAPI.handleError})},CloudAPI.cameraVideoStream=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+r+"/video/streams/"+e+"/",type:"GET"}).done(function(t){CloudAPI.cache.updateCameraVideoStream(r,e,t),o.resolve(t)}).fail(function(){o.reject()}),o},CloudAPI.cameraLimits=function(){var e=$.Deferred();
if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+o+"/limits/",type:"GET"}).done(function(o){CloudAPI.cache.setLimits(CloudAPI.cameraID(),o),e.resolve(o)}).fail(function(){e.reject()}),e},CloudAPI.cameraEventProcessingEventsMotion=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+o+"/event_processing/events/motion/",type:"GET"}).done(function(r){CloudAPI.cache.updateEventProcessingEventsMotion(o,r),e.resolve(r)}).fail(function(){e.reject()}),e},CloudAPI.updateCameraEventProcessingEventsMotion=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/event_processing/events/motion/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(){CloudAPI.cache.updateEventProcessingEventsMotion(r,e),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.cameraEventProcessingEventsSound=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+o+"/event_processing/events/sound/",type:"GET"}).done(function(r){CloudAPI.cache.updateCameraEventProcessingEventsSound(o,r),e.resolve(r)}).fail(function(){e.reject()}),e},CloudAPI.cameraSendPtz=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/send_ptz/",type:"POST",data:JSON.stringify(e),contentType:"application/json"}).done(function(e){console.log(e),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.cameraPtzExecute=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/ptz/execute/",type:"POST",data:JSON.stringify(e),contentType:"application/json"}).done(function(e){console.log(e),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.cameraPtz=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var e=e||CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+e+"/ptz/",type:"GET"}).done(function(r){CloudAPI.cache.setPtzCaps(e,r),o.resolve(r)}).fail(function(e){o.reject(e)}),o},CloudAPI.updateCameraEventProcessingEventsSound=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/event_processing/events/sound/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(){CloudAPI.cache.updateCameraEventProcessingEventsSound(r,e),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.updateCameraVideoStream=function(e,o){var r=$.Deferred();if(!CloudAPI.isCameraID())return r.reject(),r;var t=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+t+"/video/streams/"+e+"/",type:"PUT",data:JSON.stringify(o),contentType:"application/json"}).done(function(){console.log("[CLOUDAPI] [CLOUDAPI] Updated video/streams/"+e+" in cache for "+t),CloudAPI.cache.updateCameraVideoStream(t,e,o),r.resolve()}).fail(function(){r.reject()}),r},CloudAPI.setVBRQuality=function(e,o,r,t){if(CloudAPI.isCameraID()){r=void 0==r?CloudAPI.handleNothing:r,t=void 0==t?CloudAPI.handleError:t;var n={};n.vbr_quality=e,n.vbr=!0,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/video/streams/"+o+"/",type:"PUT",success:r,error:r,data:JSON.stringify(n),contentType:"application/json"})}},CloudAPI.formatMemoryCard=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+o+"/format_memory_card/",type:"POST"}).done(function(o){e.resolve(o)}).fail(function(){e.reject()}),e},CloudAPI.cameraMemoryCard=function(e){var o=$.Deferred(),e=e||CloudAPI.config.cameraID;return e?($.ajax({url:CloudAPI.config.url_cameras+e+"/memory_card/",type:"GET"}).done(function(r){CloudAPI.cache.setMemoryCard(e,r),o.resolve(r)}).fail(function(){CloudAPI.cache.setMemoryCard(e,{status:"none"}),o.reject()}),o):(o.reject(),o)},CloudAPI.cameraWifi=function(){var e=$.Deferred();return CloudAPI.isCameraID()?($.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/wifi/",type:"GET"}).done(function(o){e.resolve(o)}).fail(function(){e.reject()}),e):(e.reject(),e)},CloudAPI.cameraFirmwares=function(){var e=$.Deferred();return CloudAPI.isCameraID()?($.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/firmwares/?limit=1000",type:"GET",contentType:"application/json"}).done(function(o){e.resolve(o.objects)}).fail(function(){e.reject()}),e):(e.reject(),e)},CloudAPI.cameraFirmwaresUpgrade=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;console.log("[CLOUDAPI] upgrade firmware to version: "+e);var r={};return r.version=e,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/firmwares/upgrade/",type:"POST",data:JSON.stringify(r),contentType:"application/json"}).done(function(){o.resolve()}).fail(function(e,r){console.error("[CLOUDAPI] cameraFirmwaresUpgrade, "+r,e),o.reject()}),o},CloudAPI.accountInfo=function(){var e=$.Deferred();return $.ajax({url:CloudAPI.config.url_account,type:"GET",cache:!1}).done(function(o){CloudAPI.cache.account=o,e.resolve(o)}).fail(function(o){console.log("Fail "+CloudAPI.config.url_account),console.error(o),e.reject(o)}),e},CloudAPI.anonToken=function(){var e=$.Deferred(),o=Date.now(),r=CloudAPI.config.anonToken.expireTimeUTC-6e5,t=CloudAPI.config.anonToken.expireTimeUTC-3e5;return o>r&&t>o?($.ajaxSetup({crossDomain:!0,cache:!1,headers:{Authorization:"SkyVR "+CloudAPI.config.anonToken.token}}),e.resolve(CloudAPI.config.anonToken)):$.ajax({url:CloudAPI.config.url_account+"token/anon/",type:"GET"}).done(function(o){CloudAPI.config.anonToken.token=o.token,CloudAPI.config.anonToken.type=o.type,CloudAPI.config.anonToken.expire=o.expire,CloudAPI.config.anonToken.expireTimeUTC=Date.parse(o.expire+"Z"),CloudAPI.setToStorage("SkyVR_anonToken",JSON.stringify(CloudAPI.config.anonToken)),$.ajaxSetup({crossDomain:!0,cache:!1,headers:{Authorization:"SkyVR "+o.token}}),e.resolve(CloudAPI.config.anonToken)}).fail(function(){e.reject()}),e},CloudAPI.accountShare=function(e){var o={};return o.camid=CloudAPI.cameraID(),$.ajax({url:CloudAPI.config.url_account+"share/",type:"POST",data:JSON.stringify(e),contentType:"application/json",cache:!1})},CloudAPI.capabilities=function(e,o){e=void 0==e?CloudAPI.handleNothing:e,o=void 0==o?CloudAPI.handleError:o,$.ajax({url:CloudAPI.config.url_api+"capabilities/",type:"GET",success:e,error:o})},CloudAPI.cameraInfo=function(e){var o=$.Deferred();return e=e||CloudAPI.cameraID(),void 0==e?(o.reject(),o):$.ajax({url:CloudAPI.config.url_cameras+e+"/",type:"GET"}).done(function(r){CloudAPI.cache.cameras[r.id]&&!CloudAPI.cache.cameras[r.id].memory_card?(console.log("cameraInfo cahce has not memory card info for camid="+r.id),CloudAPI.cameraMemoryCard(r.id)):CloudAPI.cache.cameras[r.id]||(console.log("cameraInfo has not in cache for camid="+r.id),CloudAPI.cameraMemoryCard(r.id)),CloudAPI.cache.setCameraInfo(r)?CloudAPI.cameraP2PSettings(e).done(function(){o.resolve(CloudAPI.cache.cameras[e])}).fail(function(){o.resolve(CloudAPI.cache.cameras[e])}):o.resolve(CloudAPI.cache.cameras[e])}).fail(function(){o.reject()})},CloudAPI.updateCamera=function(e){var o=$.Deferred();return CloudAPI.isCameraID()?($.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(r){console.log("[CLOUDAPI] Updated camera in cache for "+CloudAPI.cameraID()),e.id=CloudAPI.cameraID(),CloudAPI.cache.updateCameraInfo(e),o.resolve(r)}).fail(function(){o.reject()}),o):(o.reject(),o)},CloudAPI.cameraMesaging=function(e){var o=$.Deferred();return e=e||CloudAPI.cameraID(),void 0==e?(o.reject(),o):$.ajax({url:CloudAPI.config.url_cameras+e+"/raw_messaging/",type:"GET"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})},CloudAPI.updateCameraAudio=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/audio/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(t){console.log("[CLOUDAPI] Updated audio in cache for "+r),CloudAPI.cache.updateCameraAudio(r,e),o.resolve(t)}).fail(function(){o.reject()}),o},CloudAPI.cameraAudio=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/audio/",type:"GET"}).done(function(r){CloudAPI.cache.updateCameraAudio(o,r),e.resolve(r)}).fail(function(){e.reject()}),e},CloudAPI.cameraVideo=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/video/",type:"GET"}).done(function(r){CloudAPI.cache.updateCameraVideo(o,r),e.resolve(r)}).fail(function(){e.reject()}),e},CloudAPI.updateCameraVideo=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var r=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+r+"/video/",type:"PUT",contentType:"application/json",data:JSON.stringify(e)}).done(function(t){CloudAPI.cache.updateCameraVideo(r,e),o.resolve(t)}).fail(function(){o.reject()}),o},CloudAPI.setCameraVideo=function(e,o,r){return CloudAPI.isCameraID()?(o=o||CloudAPI.handleNothing,r=r||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/video/",type:"PUT",success:o,error:r,contentType:"application/json",data:JSON.stringify(e)})):void 0},CloudAPI.cameraMediaStreams=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/media_streams/",type:"GET"}).done(function(r){CloudAPI.cache.setMediaStreams(o,r),e.resolve(r)}).fail(function(){e.reject()}),e},CloudAPI.updateCameraMediaStreams=function(e,o){var r=$.Deferred();return(o=o||CloudAPI.cameraID())?($.ajax({url:CloudAPI.config.url_cameras+o+"/media_streams/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(e){r.resolve(e)}).fail(function(e){r.reject(e)}),r):(r.reject(),r)},CloudAPI.cameraLiveUrls=function(e){var o=$.Deferred();return(e=e||CloudAPI.cameraID())?($.ajax({url:CloudAPI.config.url_cameras+e+"/live_urls/",type:"GET"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o):(o.reject(),o)},CloudAPI.cameraBackwardStart=function(){if(CloudAPI.isCameraID()){var e={};CloudAPI.config.backwardURL&&(e.url=CloudAPI.config.backwardURL,CloudAPI.config.tmpBackwardURL==CloudAPI.config.backwardURL?CloudAPI.config.tmpBackwardURLCount++:(CloudAPI.config.tmpBackwardURLCount=1,CloudAPI.config.tmpBackwardURL=CloudAPI.config.backwardURL),CloudAPI.isP2PStreaming()&&(console.log("[CLOUDAPI] Send (audio streaming) backward start: "+CloudAPI.config.backwardURL),$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/audio/backward/start/",type:"POST",success:CloudAPI.handleNothing,data:JSON.stringify(e),contentType:"application/json"})))}},CloudAPI.cameraBackwardStop=function(){if(CloudAPI.isCameraID()){var e={};if(CloudAPI.config.backwardURL){if(e.url=CloudAPI.config.backwardURL,CloudAPI.config.tmpBackwardURL==CloudAPI.config.backwardURL){if(0==CloudAPI.config.tmpBackwardURLCount)return;CloudAPI.config.tmpBackwardURLCount--}CloudAPI.isP2PStreaming()&&(console.log("[CLOUDAPI] Send (audio streaming) backward stop: "+CloudAPI.config.backwardURL),$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/audio/backward/stop/",type:"POST",success:CloudAPI.handleNothing,data:JSON.stringify(e),contentType:"application/json"}))}}},CloudAPI.cameraSchedule=function(){return CloudAPI.isCameraID()?$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/schedule/",type:"GET",cache:!1}):void 0},CloudAPI.updateCameraSchedule=function(e){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/schedule/",type:"PUT",data:JSON.stringify(e),cache:!1,contentType:"application/json"})},CloudAPI.hasAccessCameraPreview=function(e){var o=CloudAPI.cache.cameraInfo(e);return o?CloudAPI.hasAccess(o,"live")||CloudAPI.hasAccess(o,"all")||CloudAPI.hasAccess(o,"ptz"):!1},CloudAPI.cameraPreview=function(e,o,r){return o=void 0==o?CloudAPI.handleNothing:o,r=void 0==r?CloudAPI.handleError:r,$.ajax({url:CloudAPI.config.url_cameras+e+"/preview/",type:"GET",success:o,error:r})},CloudAPI.hasAccessCameraUpdatePreview=function(e){var o=CloudAPI.cache.cameraInfo(e);return o?CloudAPI.hasAccess(o,"live")||CloudAPI.hasAccess(o,"all")||CloudAPI.hasAccess(o,"ptz"):!1},CloudAPI.cameraUpdatePreview=function(e){return $.ajax({url:CloudAPI.config.url_cameras+e+"/preview/update/",type:"POST"})},CloudAPI.storageDataFirstRecord=function(e){var o=$.Deferred(),r={camid:CloudAPI.cameraID(),limit:1,offset:0};return e&&(r.start=e),$.ajax({url:CloudAPI.config.url_storage+"data/",data:r,cache:!1,type:"GET"}).done(function(e){e.objects.length>0?o.resolve(e.objects[0]):o.reject()}).fail(function(){o.reject()}),o},CloudAPI.storageEventsFirstRecord=function(){var e=$.Deferred(),o={camid:CloudAPI.cameraID(),limit:1,offset:0};return $.ajax({url:CloudAPI.config.url_storage+"events/",data:o,cache:!1,type:"GET"}).done(function(o){o.objects.length>0?e.resolve(o.objects[0]):e.reject()}).fail(function(){e.reject()}),e},CloudAPI.storageThumbnailsFirstRecord=function(){var e=$.Deferred(),o={camid:CloudAPI.cameraID(),limit:1,offset:0};return $.ajax({url:CloudAPI.config.url_storage+"thumbnails/",data:o,cache:!1,type:"GET"}).done(function(o){o.objects.length>0?e.resolve(o.objects[0]):e.reject()}).fail(function(){e.reject()}),e},CloudAPI.getAllData=function(){},CloudAPI.storageThumbnails=function(e,o){function r(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_storage+"thumbnails/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}var t=$.Deferred(),n={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},a={camid:CloudAPI.cameraID(),limit:n.meta.limit,offset:n.meta.offset,start:e};return o&&(a.end=o),r(a).fail(function(){t.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,n.meta.expire=e.meta.expire,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)t.resolve(n);else{for(var o=[],l=n.meta.limit;e.meta.total_count>l;l+=n.meta.limit)a.offset=l,o.push(r(a));$.when.apply($,o).done(function(){for(var e=0;arguments.length>e;e++)$.merge(n.objects,arguments[e].objects);t.resolve(n)}).fail(function(){t.reject()})}}),t},CloudAPI.storageTimeline=function(e,o){function r(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_storage+"timeline/"+CloudAPI.cameraID()+"/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}var t=$.Deferred(),n={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},a={slices:1,camid:CloudAPI.cameraID(),limit:n.meta.limit,offset:n.meta.offset,start:e};return o&&(a.end=o),r(a).fail(function(){t.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,n.meta.expire=e.meta.expire,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)t.resolve(n);else{for(var o=[],l=n.meta.limit;e.meta.total_count>l;l+=n.meta.limit)a.offset=l,o.push(r(a));$.when.apply($,o).done(function(){for(var e=0;arguments.length>e;e++)$.merge(n.objects,arguments[e].objects);t.resolve(n)}).fail(function(){t.reject()})}}),t},CloudAPI.storageEvents=function(e,o){function r(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_storage+"events/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}var t=$.Deferred(),n={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},a={camid:CloudAPI.cameraID(),limit:n.meta.limit,offset:n.meta.offset,start:e};return o&&(a.end=o),r(a).fail(function(){t.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,n.meta.expire=e.meta.expire,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)t.resolve(n);else{for(var o=[],l=n.meta.limit;e.meta.total_count>l;l+=n.meta.limit)a.offset=l,o.push(r(a));$.when.apply($,o).done(function(){for(var e=0;arguments.length>e;e++)$.merge(n.objects,arguments[e].objects);t.resolve(n)}).fail(function(){t.reject()})}}),t},CloudAPI.cameraMotionDetectionDemo=function(){var e=JSON.parse('{"caps": {"columns": 23, "max_regions": 8, "region_shape": "rect", "rows": 15, "sensitivity": "region"}}');return e},CloudAPI.cameraMotionDetection=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/motion_detection/",type:"GET"})},CloudAPI.cameraMotionDetectionRegionsDemo=function(){var e=JSON.parse('{"meta": {"limit": 20, "next": null, "offset": 0, "previous": null, "total_count": 8}, "objects": [{"enabled": true, "id": 2686, "map": "ZmQwMDBjM2ZjMDAwN2Y4MDAwZmYwMDAxZmUwMDAzZmNlNjAw", "name": "motion1", "sensitivity": 5}, {"enabled": true, "id": 2687, "map": "ZjYwMDBmMGZmODAwMWZmMDAwM2ZlMDAwN2ZjMDAwZmY4MDAxZmZmMDAw", "name": "motion2", "sensitivity": 5}, {"enabled": true, "id": 2688, "map": "ZjQwMDBmM2ZlMDAwN2ZjMDAwZmY4MDAxZmYwMDAzZmUwMDA3ZmNmMjAw", "name": "motion3", "sensitivity": 5}, {"enabled": true, "id": 2689, "map": "ZWMwMDBjMWZlMDAwM2ZjMDAwN2Y4MDAwZmYwMDAxZmVmNzAw", "name": "motion4", "sensitivity": 5}, {"enabled": true, "id": 2690, "map": "ZTQwMDA2ZTAwMDAxYzAwMDAzODBmOTAw", "name": "motion5", "sensitivity": 5}, {"enabled": true, "id": 2691, "map": "MmIwMWZmMDAwM2ZlMDAwN2ZjMDAwZmY4MDAxZmYwMDAzZmUwMDA3ZmMwMDBmZjgwMDFmZjAwMDNmZTAwMDdmYzAwMGZmODAwMWZmMDAwM2ZlMDAwN2ZjMDAw", "name": "motion6", "sensitivity": 5}, {"enabled": true, "id": 2692, "map": "MTJmZjgwMDFmZjAwMDNmZTAwMDdmYzAwMGZmODAwMWZmMDAwM2ZlMGU4MDA=", "name": "motion7", "sensitivity": 5}, {"enabled": false, "id": 2693, "map": "", "name": "motion8", "sensitivity": 5}]}');return e},CloudAPI.cameraMotionDetectionRegions=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/motion_detection/regions/",type:"GET"})},CloudAPI.cameraP2PSettings=function(e,o,r,t){return e=e||CloudAPI.cameraID(),o=void 0==o?CloudAPI.handleNothing:o,r=void 0==r?CloudAPI.handleError:r,t=void 0==t?CloudAPI.handleNothing:t,$.ajax({url:CloudAPI.config.url_cameras+e+"/p2p_settings/",type:"GET",success:function(r){CloudAPI.cache.setP2PSettings(e,r),o(r)},error:r,complete:t})},CloudAPI.cameraSetP2PSettings=function(e){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/p2p_settings/",type:"PUT",data:JSON.stringify(e),cache:!1,contentType:"application/json"})},CloudAPI.cameraLog=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/log/",type:"GET"})},CloudAPI.cameraLogDownload=function(e){var o=$.Deferred(),r=null;return r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(200==r.status?o.resolve(r.responseText):o.reject())},r.open("GET",e,!0),r.send(),o.promise()},CloudAPI.cameraLogUpdate=function(){return $.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/log/update/",type:"POST"})},CloudAPI.cameraManagersList=function(e,o){e=e||CloudAPI.handleNothing,o=o||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cmngrs,type:"GET",success:e,error:o})},CloudAPI.cameraManagerReset=function(e){return $.ajax({url:CloudAPI.config.url_cmngrs+e+"/reset/",type:"POST"})},CloudAPI.camerasList=function(e){function o(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_cameras,data:e,cache:!1,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}function r(e){var o=0,r=e.objects.length;o==r&&t.resolve(e);for(var n=0;r>n;n++)cam=e.objects[n],CloudAPI.cache.setCameraInfo(cam)?(console.log("update p2p_settings: ",cam.id),CloudAPI.cameraP2PSettings(cam.id).done(function(){CloudAPI.cameraMemoryCard(cam.id).done(function(){o+=1,o==r&&t.resolve(e)}).fail(function(){o+=1,o==r&&t.resolve(e)})}).fail(function(){o+=1,o==r&&t.resolve(e)})):(o+=1,o==r&&t.resolve(e))}e=e||{};var t=$.Deferred(),n={meta:{limit:20,offset:0,total_count:-1},objects:[]},a={limit:n.meta.limit,offset:n.meta.offset};for(var l in e)a[l]=e[l];return o(a).fail(function(){t.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)r(n);else{for(var l=[],i=n.meta.limit;e.meta.total_count>i;i+=n.meta.limit)a.offset=i,l.push(o(a));$.when.apply($,l).done(function(){for(var e=0;arguments.length>e;e++)$.merge(n.objects,arguments[e].objects);r(n)}).fail(function(){t.reject()})}}),t},CloudAPI.camerasListByCriterions=function(e,o,r){o=o||CloudAPI.handleNothing,r=r||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cameras,data:e,type:"GET",success:o,error:r})},CloudAPI.cameraManagerInfo=function(e,o,r){o=o||CloudAPI.handleNothing,r=r||CloudAPI.handleError,$.ajax({url:CloudAPI.config.url_cmngrs+e+"/",type:"GET",success:o,error:r})},CloudAPI.cameraManagerSetTimezone=function(e,o,r,t){r=r||CloudAPI.handleNothing,t=t||CloudAPI.handleError;var n={};n.timezone=o,$.ajax({url:CloudAPI.config.url_cmngrs+e+"/",type:"PUT",success:r,error:t,data:JSON.stringify(n),contentType:"application/json"})},CloudAPI.storageClipList=function(){function e(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_clips,data:e,cache:!1,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}var o=$.Deferred(),r={meta:{limit:100,offset:0,total_count:-1},objects:[]},t={limit:r.meta.limit,offset:r.meta.offset,camid:CloudAPI.cameraID(),usecamtz:""};return e(t).fail(function(){o.reject()}).done(function(n){if(r.meta.total_count=n.meta.total_count,r.meta.expire=n.meta.expire,$.merge(r.objects,n.objects),n.meta.offset+n.objects.length>=n.meta.total_count)o.resolve(r);else{for(var a=[],l=r.meta.limit;n.meta.total_count>l;l+=r.meta.limit)t.offset=l,a.push(e(t));$.when.apply($,a).done(function(){for(var e=0;arguments.length>e;e++)$.merge(r.objects,arguments[e].objects);o.resolve(r)}).fail(function(){o.reject()})}}),o},CloudAPI.storageClipListAnon=function(e){var o=$.Deferred();return CloudAPI.anonToken().done(function(r){function t(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_clips,data:e,cache:!1,type:"GET",headers:{Authorization:"SkyVR "+r.token}}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}var n={meta:{limit:100,offset:0,total_count:-1},objects:[]},a={limit:n.meta.limit,offset:n.meta.offset,usecamtz:""};e&&(a.token=e),t(a).fail(function(){o.reject()}).done(function(e){if(n.meta.total_count=e.meta.total_count,n.meta.expire=e.meta.expire,$.merge(n.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)o.resolve(n);else{for(var r=[],l=n.meta.limit;e.meta.total_count>l;l+=n.meta.limit)a.offset=l,r.push(t(a));$.when.apply($,r).done(function(){for(var e=0;arguments.length>e;e++)$.merge(n.objects,arguments[e].objects);o.resolve(n)}).fail(function(){o.reject()})}})}).fail(function(){o.reject()}),o},CloudAPI.storageClipCreate=function(e,o,r,t,n){var a={};return a.camid=CloudAPI.cameraID(),a.title=e,a.group=o,a.start=r,a.end=t,a.delete_at=n,$.ajax({url:CloudAPI.config.url_clips,type:"POST",data:JSON.stringify(a),cache:!1,contentType:"application/json"})},CloudAPI.storageClip=function(e){return $.ajax({url:CloudAPI.config.url_clips+e+"/",type:"GET",cache:!1})},CloudAPI.serverTime=function(){return $.ajax({url:CloudAPI.config.url_server+"time/",type:"GET",cache:!1})},CloudAPI.storageClipAnon=function(e,o){var r=$.Deferred(),t={};return o&&(t.token=o),CloudAPI.anonToken().done(function(o){$.ajax({url:CloudAPI.config.url_clips+e+"/",type:"GET",data:t,cache:!1,headers:{Authorization:"SkyVR "+o.token}}).done(function(e){r.resolve(e)}).fail(function(){r.reject()})}).fail(function(){r.reject()}),r},CloudAPI.storageClipDelete=function(e){return $.ajax({url:CloudAPI.config.url_clips+e+"/",type:"DELETE",cache:!1})},CloudAPI.storageClipUpdate=function(e,o){return $.ajax({url:CloudAPI.config.url_clips+e+"/",data:JSON.stringify(o),type:"PUT",cache:!1,contentType:"application/json"})},CloudAPI.cameraSettings=function(){function e(e){var o=$.Deferred();return e.always(function(){o.resolve()}),o}function o(){var e=$.Deferred();return CloudAPI.cameraMediaStreams().done(function(o){console.log("MediaStreams: ",o);var r=o.mstreams_supported,t=o.live_ms_id;if(r.length>0&&""!=t){for(var n="",a=0;r.length>a;a++)if(r[a].id==t){n=r[a].vs_id;break}""!=n?CloudAPI.cameraVideoStream(n).done(function(){e.resolve()}).fail(function(){e.reject()}):e.reject()}else e.resolve()}).fail(function(){e.reject()}),e}var r=$.Deferred(),t=[];return t.push(e(o())),CloudAPI.cache.cameraInfo().url||(t.push(e(CloudAPI.cameraVideo())),t.push(e(CloudAPI.cameraAudio())),t.push(e(CloudAPI.cameraLimits())),t.push(e(CloudAPI.cameraEventProcessingEventsMotion())),t.push(e(CloudAPI.cameraEventProcessingEventsSound())),t.push(e(CloudAPI.cameraMemoryCard()))),$.when.apply($,t).done(function(){r.resolve(CloudAPI.cache.cameraInfo())}).fail(function(){r.reject()}),r},CloudAPI.createCamsess=function(e){return e=e||{},$.ajax({url:CloudAPI.config.url_camsess,data:JSON.stringify(e),type:"POST",contentType:"application/json",cache:!1})},CloudAPI.updateCamsess=function(e,o){return o=o||{},$.ajax({url:CloudAPI.config.url_camsess+e+"/",data:JSON.stringify(o),type:"PUT",contentType:"application/json",cache:!1})},CloudAPI.cameraCreate=function(e){var o=$.Deferred();return e=e||{},$.ajax({url:CloudAPI.config.url_cameras,type:"POST",data:JSON.stringify(e),cache:!1,contentType:"application/json"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o},CloudAPI.cameraDelete=function(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_cameras+e+"/",type:"DELETE",cache:!1}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o},CloudAPI.cameraUpdate=function(e,o){var r=$.Deferred();return o=o||{},$.ajax({url:CloudAPI.config.url_cameras+e+"/",type:"PUT",data:JSON.stringify(o),cache:!1,contentType:"application/json"}).done(function(e){r.resolve(e)}).fail(function(e){r.reject(e)}),r},CloudAPI.adminCameras=function(e){return e=e||{},$.ajax({url:CloudAPI.config.url_admin_cameras,data:e,type:"GET",cache:!1})},CloudAPI.adminCameraInfo=function(e){return $.ajax({url:CloudAPI.config.url_admin_cameras+e+"/",type:"GET",cache:!1})},CloudAPI.updateAdminCamera=function(e,o){return o=o||{},$.ajax({url:CloudAPI.config.url_admin_cameras+e+"/",type:"PUT",data:JSON.stringify(o),contentType:"application/json",cache:!1})},CloudAPI.store={},CloudAPI.store.volume=function(e){return e&&CloudAPI.setToStorage("volume",e),CloudAPI.getFromStorage("volume")},CloudAPI.store.prev_volume=function(e){return e&&CloudAPI.setToStorage("prev_volume",e),CloudAPI.getFromStorage("prev_volume")},CloudAPI.store.zoom=function(e){return void 0!=e&&CloudAPI.setToStorage("zoom",e),CloudAPI.getFromStorage("zoom")},CloudAPI.store.zoom_left=function(e){return void 0!=e&&CloudAPI.setToStorage("zoom_left",e),CloudAPI.getFromStorage("zoom_left")},CloudAPI.store.zoom_top=function(e){return void 0!=e&&CloudAPI.setToStorage("zoom_top",e),CloudAPI.getFromStorage("zoom_top")},CloudAPI.store.user_profile=function(e){return void 0!=e&&CloudAPI.setToStorage("user_profile",e),CloudAPI.getFromStorage("user_profile")},CloudAPI.store.svcp_host=function(e){return void 0!=e&&CloudAPI.setToStorage("svcp_host",e),CloudAPI.getFromStorage("svcp_host")},CloudAPI.storageTemp={},CloudAPI.storageMode="local",CloudAPI.detectStorageMode=function(){try{localStorage.setItem("detectStorageMode","yes")}catch(e){CloudAPI.storageMode="temp"}},CloudAPI.detectStorageMode(),CloudAPI.setToStorage=function(e,o){"local"==CloudAPI.storageMode?localStorage.setItem(e,o):CloudAPI.storageTemp[e]=o},CloudAPI.getFromStorage=function(e){return"local"==CloudAPI.storageMode?localStorage.getItem(e):CloudAPI.storageTemp[e]},CloudAPI.removeFromStorage=function(e){"local"==CloudAPI.storageMode?localStorage.removeItem(e):CloudAPI.storageTemp[e]=void 0},CloudAPI.loadApiTokenFromHref=function(){var e=window.location.href.split("#"),o=e[e.length-1];o=o.split("&");for(var r in o){var t=o[r].split("=")[0],n=decodeURIComponent(o[r].split("=")[1]);"token"==t?(CloudAPI.config.apiToken=CloudAPI.config.apiToken||{},CloudAPI.config.apiToken.token=n,CloudAPI.config.apiToken.type="api"):"expire"==t&&(CloudAPI.config.apiToken=CloudAPI.config.apiToken||{},CloudAPI.config.apiToken.expire=n,CloudAPI.config.apiToken.expireTimeUTC=Date.parse(n+"Z"))}console.log("Href token: ",CloudAPI.config.apiToken),CloudAPI.setToStorage("SkyVR_apiToken",JSON.stringify(CloudAPI.config.apiToken))},CloudAPI.cleanupApiToken=function(){CloudAPI.removeFromStorage("SkyVR_apiToken"),CloudAPI.config.apiToken=null,$.ajaxSetup({crossDomain:!0,cache:!1,beforeSend:function(e){e.setRequestHeader("Authorization","")}})},CloudHelpers.containsPageParam("svcp_host")?CloudAPI.setURL(CloudAPI.pageParams.svcp_host):CloudAPI.getFromStorage("CloudAPI_svcp_host")?CloudAPI.setURL(CloudAPI.getFromStorage("CloudAPI_svcp_host")):CloudAPI.setURL(window.location.protocol+"//"+(""+window.location.host)+"/"),CloudAPI.events={},CloudAPI.events.listeners={},CloudAPI.events.names=["CAMERA_INFO_CHANGED"],CloudAPI.events.on=function(e,o,r){return-1==CloudAPI.events.names.indexOf(e)?(console.error("[CLOUDAPI] Could not find event with name "+e),void 0):(CloudAPI.events.listeners[e]||(CloudAPI.events.listeners[e]={}),CloudAPI.events.listeners[e][o]=r,void 0)},CloudAPI.events.off=function(e,o){return-1==CloudAPI.events.names.indexOf(e)?(console.error("[CLOUDAPI] Could not find event with name "+e),void 0):CloudAPI.events.listeners[e]?CloudAPI.events.listeners[e][o]?(delete CloudAPI.events.listeners[e][o],void 0):(console.error("[CLOUDAPI] Could not find event with name "+e+" by id "+o),void 0):(console.error("[CLOUDAPI] Could not find event with name "+e),void 0)},CloudAPI.events.trigger=function(e,o){if(-1==CloudAPI.events.names.indexOf(e))return console.error("[CLOUDAPI] Could not find event with name "+e),void 0;if(CloudAPI.events.listeners[e]){var r=CloudAPI.events.listeners[e];setTimeout(function(){for(var e in r)try{r[e](o)}catch(t){console.error("[CLOUDAPI] error on execute callback event ("+e+")",t)}},1)}},window.CloudReturnCode={},CloudReturnCode.OK={name:"OK",code:-5049,text:"Success"},CloudReturnCode.OK_COMPLETIONPENDING={name:"OK_COMPLETIONPENDING",code:1,text:"Operation Pending"},CloudReturnCode.ERROR_NOT_CONFIGURED={name:"ERROR_NOT_CONFIGURED",code:-2,text:"Object not configured"},CloudReturnCode.ERROR_NOT_IMPLEMENTED={name:"ERROR_NOT_IMPLEMENTED",code:-1,text:"Function not implemented"},CloudReturnCode.ERROR_NO_MEMORY={name:"ERROR_NO_MEMORY",code:-12,text:"Out of memory"},CloudReturnCode.ERROR_ACCESS_DENIED={name:"ERROR_ACCESS_DENIED",code:-13,text:"Access denied"},CloudReturnCode.ERROR_BADARGUMENT={name:"ERROR_BADARGUMENT",code:-22,text:"Invalid argument"},CloudReturnCode.ERROR_STREAM_UNREACHABLE={name:"ERROR_STREAM_UNREACHABLE",code:-5049,text:"The stream specified is not reachable. Please check source URL or restart the stream"},CloudReturnCode.ERROR_EXPECTED_FILTER={name:"ERROR_EXPECTED_FILTER",code:-5050,text:"Expected filter"},CloudReturnCode.ERROR_NO_CLOUD_CONNECTION={name:"ERROR_NO_CLOUD_CONNECTION",code:-5051,text:"No cloud connection (has not conenction object or token is invalid)"},CloudReturnCode.ERROR_WRONG_RESPONSE={name:"ERROR_WRONG_RESPONSE",code:-5052,text:"Response from cloud expected in json, but got something else"},CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED={name:"ERROR_SOURCE_NOT_CONFIGURED",code:-5053,text:"Source not configured"},CloudReturnCode.ERROR_INVALID_SOURCE={name:"ERROR_INVALID_SOURCE",code:-5054,text:"Invalid source"},CloudReturnCode.ERROR_RECORDS_NOT_FOUND={name:"ERROR_RECORDS_NOT_FOUND",code:-5055,text:"Records are not found"},CloudReturnCode.ERROR_STREAM_UNREACHABLE_HLS={name:"ERROR_STREAM_UNREACHABLE_HLS",code:-5056,text:"The stream specified is not reachable (HLS)."},CloudReturnCode.ERROR_NOT_FOUND_HLS_PLUGIN={name:"ERROR_NOT_FOUND_HLS_PLUGIN",code:-5057,text:"HLS plugin not found."},CloudReturnCode.ERROR_COULD_NOT_DECODE_STREAM_OR_COULD_NOT_SET_COOKIE_HLS={name:"ERROR_COULD_NOT_DECODE_STREAM_OR_COULD_NOT_SET_COOKIE_HLS",code:-5058,text:"Could not decode stream or could not set cookie for streaming server (please allow cookie)."},CloudReturnCode.ERROR_NOT_AUTHORIZED={name:"ERROR_NOT_AUTHORIZED",code:-5401,text:"Failed authorization on cloud (wrong credentials)"},CloudReturnCode.ERROR_NOT_FOUND={name:"ERROR_NOT_FOUND",code:-5404,text:"Not found object"},window.CloudCameraPrivacyFilter={},CloudCameraPrivacyFilter.PS_OWNER_NOT_PUBLIC={name:"PS_OWNER_NOT_PUBLIC",code:0,text:"My cameras which not public"},CloudCameraPrivacyFilter.PS_OWNER={name:"PS_OWNER",code:1,text:"Only my cameras"},CloudCameraPrivacyFilter.PS_PUBLIC_NOT_OWNERS={name:"PS_PUBLIC_NOT_OWNERS",code:2,text:"Public cameras exclude my"},CloudCameraPrivacyFilter.PS_PUBLIC={name:"PS_PUBLIC",code:3,text:"All public cameras"},CloudCameraPrivacyFilter.PS_OWNERS_PUBLIC={name:"PS_OWNERS_PUBLIC",code:4,text:"My public cameras"},CloudCameraPrivacyFilter.PS_ALL={name:"PS_ALL",code:5,text:"All cameras"},window.CloudCameraRecordingMode={},CloudCameraRecordingMode.CONTINUES={name:"CONTINUES",code:0},CloudCameraRecordingMode.BY_EVENT={name:"BY_EVENT",code:1},CloudCameraRecordingMode.NO_RECORDING={name:"NO_RECORDING",code:2},window.CloudCameraStatus={},CloudCameraStatus.ACTIVE={name:"ACTIVE",code:0},CloudCameraStatus.UNAUTHORIZED={name:"UNAUTHORIZED",code:1},CloudCameraStatus.INACTIVE={name:"INACTIVE",code:2},CloudCameraStatus.INACTIVE_BY_SCHEDULER={name:"INACTIVE_BY_SCHEDULER",code:3},CloudCameraStatus.OFFLINE={name:"OFFLINE",code:4},window.CloudTrialConnection=function(){var e=this;
e.mAPI=null,e.AccountProviderUrl=window.location.protocol+"//cnvrclient2.videoexpertsgroup.com/",e.setAccpUrl=function(o){e.AccountProviderUrl=o},e.setSvcpUrlBase=function(o){e.ServiceProviderUrl=o},e.open=function(o){var r=CloudHelpers.promise();return e.TrialKey=o,e.RequestData={username:e.TrialKey,password:e.TrialKey,cloud_token:!0},e._asyncLogin(r),r},e.isOpened=function(){return null!=e.mAPI},e.close=function(){e.mAPI=null},e._getAPI=function(){return e.mAPI},e.getUserInfo=function(){var o=CloudHelpers.promise();return e.isOpened()?(e.mAPI.getAccountInfo().done(function(r){e.mAPI.getAccountCapabilities().done(function(t){var n=new CloudUserInfo(e,r,t);o.resolve(n)}).fail(function(e){CloudHelpers.handleError(e,o)})}).fail(function(e){CloudHelpers.handleError(e,o)}),o):(o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o)},e.getServerTimeDiff=function(){return e.mAPI.diffServerTime},e._asyncLogin=function(o){CloudHelpers.request({url:e.AccountProviderUrl+"api/v1/account/login/",type:"POST",data:JSON.stringify(e.RequestData),contentType:"application/json"}).done(function(r){if(r.cloud_token&&r.cloud_token.token){var t=CloudHelpers.parseUri(r.svcp_auth_app_url).host;t=window.location.protocol+"//"+t+"/",e.mAPI=new CloudAPI(r.cloud_token,e.ServiceProviderUrl||t),e.mAPI.getServerTime().done(function(){o.resolve()}).fail(function(e){o.reject(e)})}else console.warn("Try again after 1 sec"),setTimeout(function(){e._asyncLogin(o)},1e3)}).fail(function(e){console.error(e),o.reject(e)})}},window.CloudTokenConnection=function(){var e=this;e.mAPI=null,e.ServiceProviderUrl=window.location.protocol+"//web.skyvr.videoexpertsgroup.com/",e.open=function(o,r,t){var n={token:o,expire:r,type:"api"};t&&(e.ServiceProviderUrl=t);var a=CloudHelpers.promise();return e.mAPI=new CloudAPI(n,e.ServiceProviderUrl),e.mAPI.getServerTime().done(function(){a.resolve()}).fail(function(e){a.reject(e)}),a},e.isOpened=function(){return null!=e.mAPI},e.close=function(){e.mAPI=null},e._getAPI=function(){return e.mAPI},e.getUserInfo=function(){var o=CloudHelpers.promise();return e.isOpened()?(e.mAPI.getAccountInfo().done(function(r){e.mAPI.getAccountCapabilities().done(function(t){console.warn("caps:",t);var n=new CloudUserInfo(e,r,t);o.resolve(n)}).fail(function(e){CloudHelpers.handleError(e,o)})}).fail(function(e){CloudHelpers.handleError(e,o)}),o):(o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o)},e.getServerTimeDiff=function(){return e.mAPI.diffServerTime}},window.CloudShareConnection=function(){var e=this;e.mAPI=null,e.ServiceProviderUrl=window.location.protocol+"//web.skyvr.videoexpertsgroup.com/",e.open=function(o){var r={token:o,expire:"",type:"share"},t=CloudHelpers.promise();return e.mAPI=new CloudAPI(r,e.ServiceProviderUrl),e.mAPI.getServerTime().done(function(){t.resolve()}).fail(function(e){t.reject(e)}),t},e.isOpened=function(){return null!=e.mAPI},e.close=function(){e.mAPI=null},e._getAPI=function(){return e.mAPI},e.getUserInfo=function(){var o=CloudHelpers.promise();return e.isOpened()?(e.mAPI.getAccountInfo().done(function(r){e.mAPI.getAccountCapabilities().done(function(t){console.warn("caps:",t);var n=new CloudUserInfo(e,r,t);o.resolve(n)}).fail(function(e){CloudHelpers.handleError(e,o)})}).fail(function(e){CloudHelpers.handleError(e,o)}),o):(o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o)},e.getServerTimeDiff=function(){return e.mAPI.diffServerTime}},window.CloudUserConnection=function(){var e=this;e.mAPI=null,e.AccountProviderUrl=window.location.protocol+"//cnvrclient2.videoexpertsgroup.com/";var o,r;e.open=function(t,n){o=t,r=n;var a=CloudHelpers.promise();return e.RequestData={username:o,password:r,cloud_token:!0},e._asyncLogin(a),a},e.isOpened=function(){return null!=e.mAPI},e.close=function(){e.mAPI=null},e._getAPI=function(){return e.mAPI},e.getUserInfo=function(){var o=CloudHelpers.promise();return e.isOpened()?(e.mAPI.getAccountInfo().done(function(r){e.mAPI.getAccountCapabilities().done(function(t){console.warn("caps:",t);var n=new CloudUserInfo(e,r,t);o.resolve(n)}).fail(function(t){if(500==t.status){var n=new CloudUserInfo(e,r);o.resolve(n)}else CloudHelpers.handleError(t,o)})}).fail(function(e){CloudHelpers.handleError(e,o)}),o):(o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o)},e.getServerTimeDiff=function(){return e.mAPI.diffServerTime},e._asyncLogin=function(o){CloudHelpers.request({url:e.AccountProviderUrl+"api/v1/account/login/",type:"POST",data:JSON.stringify(e.RequestData),contentType:"application/json"}).done(function(r){if(r.cloud_token&&r.cloud_token.token){var t=CloudHelpers.parseUri(r.svcp_auth_app_url).host;t=window.location.protocol+"//"+t+"/",e.mAPI=new CloudAPI(r.cloud_token,t),e.mAPI.getServerTime().done(function(){o.resolve()}).fail(function(e){o.reject(e)})}else console.warn("Try again after 1 sec"),setTimeout(function(){e._asyncLogin(o)},1e3)}).fail(function(e){console.error(e),o.reject(e)})}},window.CloudUserInfo=function(e,o,r){function t(e,o){n=e,a=o,l=e.id,i=e.email,s=e.first_name,u=e.last_name,c=e.preferred_name,o?(m=o.cameras_creation.limits.total_cameras,d=o.cameras_creation.limits.hosted_cameras,p=o.cameras_creation.created.total_cameras,f=o.cameras_creation.created.hosted_cameras):(m=0,d=0,p=0,f=0)}var n,a,l,i,s,u,c,d,m,f,p,C=this,v=e;t(o,r),C._getConn=function(){return v},C._origJsonAccount=function(){return n},C._origJsonCapabilities=function(){return a},C.getID=function(){return l},C.getEmail=function(){return i},C.getFirstName=function(){return s},C.getLastName=function(){return u},C.getPreferredName=function(){return c},C.getCameraLimit=function(){return m},C.getCameraCreated=function(){return p},C.refresh=function(){var e=CloudHelpers.promise();return v&&v.isOpened()?(v._getAPI().getAccountInfo().done(function(o){v._getAPI().getAccountCapabilities().done(function(r){t(o,r),e.resolve()}).fail(function(r){500==r.status?t(o):CloudHelpers.handleError(r,e)})}).fail(function(o){CloudHelpers.handleError(o,e)}),e):(e.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),e)}},window.CloudCamera=function(e,o){function r(e){l=e,s=e.login,u=e.password,i=e.url,C=e.name,d=e.timezone,c=e.status,m=e.latitude,f=e.longitude,v=e.rec_mode,g="on"==e.rec_status,p=e.delete_at,_=e.brand,P=e.group_name,I=e.fw_version,A=e.model,mSerialNumber=e.serial_number,y=e.uuid,h=e.led,T=e.public?e.public:!1}function t(e){var o={};return o.token=e,o.camid=E,o.access="watch",R.ServiceProviderUrl&&(o.svcp=R.ServiceProviderUrl),console.log("js: "+JSON.stringify(o)),console.log("js2: "+btoa(JSON.stringify(o))),CloudHelpers.base64_encode(JSON.stringify(o))}function n(e){var o={};return o.token=e,o.camid=E,o.cmngrid=O,o.access="all",R.ServiceProviderUrl&&(o.svcp=R.ServiceProviderUrl),console.log("js: "+JSON.stringify(o)),console.log("js2: "+btoa(JSON.stringify(o))),CloudHelpers.base64_encode(JSON.stringify(o))}var a=this;a.type="camera";var l,i,s,u,c,d,m,f,p,C,v,g,_,P,I,h,A,y,T,R=e,E=o.id,O=o.cmngrid,w={};r(o),a._getConn=function(){return console.log("mConn = "+R),R},a._origJson=function(){return l},a.getID=function(){return E},a.getRecStatus=function(){console.warn("TODO")},a.hasPTZ=function(){console.warn("TODO")},a.getURL=function(){return i},a.setURL=function(e){i=e,w.url=e},a.getURLLogin=function(){return s},a.setURLLogin=function(e){s=e,w.login=e},a.getURLPassword=function(){return u},a.setURLPassword=function(e){u=e,w.password=e},a.getDeleteAt=function(){return p},a.getTimezone=function(){return d},a.setTimezone=function(e){d=e,w.timezone=e},a.isPublic=function(){return T},a.setPublic=function(e){T=e,w["public"]=e},a.getStatus=function(){var e=c.toUpperCase();return CloudCameraStatus[e]?CloudHelpers.copy(CloudCameraStatus[e]):(console.error("Unknown camera status"),null)},a.getName=function(){return C},a.setName=function(e){C=e,w.name=e},a.getLatitude=function(){return m},a.setLatitude=function(e){m=e,w.latitude=e},a.getLongitude=function(){return f},a.setLongitude=function(e){f=e,w.longitude=e},a.isRecording=function(){return g},a.getCameraManagerID=function(){return O},a.getBrand=function(){return _},a.getGroupName=function(){return P},a.getFirmwareVersion=function(){return I},a.getModel=function(){return A},a.getUUID=function(){return y},a.getLed=function(){return h},a.setRecordingMode=function(e){e.name==CloudCameraRecordingMode.CONTINUES.name?w.rec_mode="on":e.name==CloudCameraRecordingMode.BY_EVENT.name?w.rec_mode="by_event":e.name==CloudCameraRecordingMode.NO_RECORDING.name?w.rec_mode="off":console.error("[CloudCamera] Unknown mode of recording")},a.getRecordingMode=function(){return"on"==v?CloudHelpers.copy(CloudCameraRecordingMode.CONTINUES):"by_event"==v?CloudHelpers.copy(CloudCameraRecordingMode.BY_EVENT):"off"==v?CloudHelpers.copy(CloudCameraRecordingMode.NO_RECORDING):(console.error("[CloudCamera] Unknown mode of recording"),void 0)},a.save=function(){var e=CloudHelpers.promise();return R._getAPI().updateCamera(E,w).done(function(o){r(o),w.timezone?R._getAPI().updateCameraManager(O,{timezone:w.timezone}).done(function(){d=w.timezone,w={},e.resolve()}).fail(function(o){CloudHelpers.handleError(o,e)}):(w={},e.resolve())}).fail(function(o){CloudHelpers.handleError(o,e)}),e},a.getPreview=function(){var e=CloudHelpers.promise();if(!R||!R.isOpened())return e.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),e;var o=R._getAPI().diffServerTime;return R._getAPI().cameraPreview(E).done(function(r){console.log(r);var t=CloudHelpers.parseUTCTime(r.time);curr_time=CloudHelpers.getCurrentTimeUTC()+o,(curr_time-t)/1e3>60?R._getAPI().cameraUpdatePreview(E).done(function(){e.resolve(r.url)}).fail(function(o){CloudHelpers.handleError(o,e)}):e.resolve(r.url)}).fail(function(o){CloudHelpers.handleError(o,e)}),e},a.getTimeline=function(e,o){var r=CloudHelpers.promise();if(!R||!R.isOpened())return r.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),r;var t=CloudHelpers.formatUTCTime(e),n=CloudHelpers.formatUTCTime(o),a=2;return R._getAPI().storageTimeline(E,t,n,a).done(function(t){var n={};n.start=e,n.end=o,n.periods=[];var l=t.objects[0][a];for(var i in l){var s={};s.start=CloudHelpers.parseUTCTime(l[i][0]),s.end=s.start+1e3*l[i][1],n.periods.push(s)}r.resolve(n)}).fail(function(e){CloudHelpers.handleError(e,r)}),r},a.getTimelineDays=function(e){var o=CloudHelpers.promise();return R&&R.isOpened()?(R._getAPI().storageActivity(E,e).done(function(e){var r=[];for(var t in e.objects)r.push(CloudHelpers.parseUTCTime(e.objects[t]+"T00:00:00"));o.resolve(r)}).fail(function(e){CloudHelpers.handleError(e,o)}),o):(o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o)},a.getCameraUsage=function(){var e=CloudHelpers.promise();return R&&R.isOpened()?(R._getAPI().cameraUsage(E).done(function(o){e.resolve(o)}).fail(function(o){CloudHelpers.handleError(o,e)}),e):(e.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),e)};var S="COMMON_SHARING_TOKEN";a.enableSharing=function(){var e=CloudHelpers.promise();return R&&R.isOpened()?(R._getAPI().getCameraSharingTokensList(E).done(function(o){var r=!1;for(var n in o.objects){var a=o.objects[n];if(a.name==S)return r=!0,1==a.enabled?e.resolve(t(a.token,E,"watch")):R._getAPI().updateCameraSharingToken(E,a.id,{enabled:!0}).done(function(){e.resolve(t(a.token,E,"watch"))}).fail(function(o){CloudHelpers.handleError(o,e)}),void 0}r||R._getAPI().creareCameraSharingToken(E,S,["live","play"]).done(function(o){e.resolve(t(o.token,E,"watch"))}).fail(function(o){CloudHelpers.handleError(o,e)})}).fail(function(o){CloudHelpers.handleError(o,e)}),e):(e.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),e)},a.disableSharing=function(){var e=CloudHelpers.promise();return R&&R.isOpened()?(R._getAPI().getCameraSharingTokensList(E).done(function(o){var r=!1;for(var t in o.objects){var n=o.objects[t];if(n.name==S)return r=!0,R._getAPI().updateCameraSharingToken(E,n.id,{enabled:!1}).done(function(o){console.log(o),e.resolve()}).fail(function(o){CloudHelpers.handleError(o,e)}),void 0}e.reject()}).fail(function(o){CloudHelpers.handleError(o,e)}),e):(e.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),e)};var D="COMMON_SHARING_TOKEN_FOR_STREAM";a.enableSharingForStream=function(){var e=CloudHelpers.promise();return R&&R.isOpened()?(R._getAPI().getCameraSharingTokensList(E).done(function(o){var r=!1;for(var t in o.objects){var a=o.objects[t];if(a.name==D)return r=!0,1==a.enabled?e.resolve(n(a.token)):R._getAPI().updateCameraSharingToken(E,a.id,{enabled:!0}).done(function(){e.resolve(n(a.token))}).fail(function(o){CloudHelpers.handleError(o,e)}),void 0}r||R._getAPI().creareCameraSharingToken(E,D,["all"]).done(function(o){e.resolve(n(o.token))}).fail(function(o){CloudHelpers.handleError(o,e)})}).fail(function(o){CloudHelpers.handleError(o,e)}),e):(e.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),e)}},window.CloudCameraListFilter=function(){var e=this;e.filterParams={detail:"detail",limit:50},e.setLimit=function(o){e.filterParams.limit=o},e.setOffset=function(o){e.filterParams.offset=o},e.setName=function(o){void 0!==o?e.filterParams.name=o:delete e.filterParams.name},e.setPartOfName=function(o){void 0!==o?e.filterParams.name__icontains=o:delete e.filterParams.name__icontains},e.sortByName=function(o){e.filterParams.order_by=(o?"-":"")+"name"},e.sortByDate=function(o){e.filterParams.order_by=(o?"-":"")+"created"},e.setOwner=function(o){console.warn("setPublic is deprecated"),void 0!==o?e.filterParams.is_owner=o:delete e.filterParams.is_owner},e.setPublic=function(o){console.warn("setPublic is deprecated"),void 0!==o?e.filterParams["public"]=o:delete e.filterParams["public"]},e.setForStream=function(o){void 0!==o?void 0!==o?e.filterParams.url__isnull=o:delete e.filterParams.url__isnull:delete e.filterParams.url__isnull},e.setPrivacy=function(o){void 0!==o&&o.name?"PS_OWNER_NOT_PUBLIC"==o.name?(e.filterParams["public"]=!1,e.filterParams.is_owner=!0):"PS_OWNER"==o.name?(delete e.filterParams["public"],e.filterParams.is_owner=!0):"PS_PUBLIC_NOT_OWNERS"==o.name?(e.filterParams["public"]=!0,e.filterParams.is_owner=!1):"PS_PUBLIC"==o.name?(e.filterParams["public"]=!0,delete e.filterParams.is_owner):"PS_OWNERS_PUBLIC"==o.name?(e.filterParams["public"]=!0,e.filterParams.is_owner=!0):"PS_ALL"==o.name?(delete e.filterParams["public"],delete e.filterParams.is_owner):(console.error("Unknown privacy filter"),delete e.filterParams["public"],delete e.filterParams.is_owner):(console.error("Unknown privacy filter"),delete e.filterParams["public"],delete e.filterParams.is_owner)},e.setURL=function(o){void 0!==o?e.filterParams.url=o:delete e.filterParams.url},e.setLatLngBounds=function(o,r,t,n){console.warn("[CloudCamerasListFilter] SetLatLngBounds, TODO test -1 < lat,lang < 1"),r>=o&&(e.filterParams.latitude__gte=o,e.filterParams.latitude__lte=r),n>=t&&(e.filterParams.longitude__gte=t,e.filterParams.longitude__lte=n)},e._values=function(){return e.filterParams}},window.CloudCameraList=function(e){var o=this,r=e;o.getCamera=function(e){var o=CloudHelpers.promise();return r&&r.isOpened()?(r._getAPI().getCamera(e).done(function(e){o.resolve(new CloudCamera(r,e))}).fail(function(e){CloudHelpers.handleError(e,o)}),o):(o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o)},o.createCamera=function(e,o,t){var n=CloudHelpers.promise();if(!r||!r.isOpened())return n.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),n;var a={url:e,login:o,password:t};return r._getAPI().createCamera(a).done(function(e){n.resolve(new CloudCamera(r,e))}).fail(function(e){CloudHelpers.handleError(e,n)}),n},o.createCameraForStream=function(){var e=CloudHelpers.promise();if(!r||!r.isOpened())return e.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),e;var o={};return r._getAPI().createCamera(o).done(function(o){e.resolve(new CloudCamera(r,o))}).fail(function(o){CloudHelpers.handleError(o,e)}),e},o.findOrCreateCamera=function(e){var t=CloudHelpers.promise(),n=new CloudCameraListFilter;n.setOwner(!0);var a=CloudHelpers.splitUserInfoFromURL(e);return n.setURL(a.url),a.login=a.login||"",r._getAPI().camerasList(n._values()).done(function(e){var n=!1;for(var l in e.objects){var i=e.objects[l];if(i.login=i.login||"",i.login==a.login){n=!0,t.resolve(new CloudCamera(r,i));break}}n||o.createCamera(a.url,a.login,a.password).done(function(e){t.resolve(e)}).fail(function(e){CloudHelpers.handleError(e,t)})}).fail(function(e){CloudHelpers.handleError(e,t)}),t},o.getCameraList=function(e){var o=CloudHelpers.promise();return e=e||new CloudCameraListFilter,e._values?r&&r.isOpened()?(r._getAPI().camerasList(e._values()).done(function(e){var t=[];for(var n in e.objects)t.push(new CloudCamera(r,e.objects[n]));o.resolve(t)}).fail(function(e){CloudHelpers.handleError(e,o)}),o):(o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o):(console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),o.reject(CloudReturnCode.ERROR_EXPECTED_FILTER),o)},o.getCameraListLight=function(e){var o=CloudHelpers.promise();if(e=e||new CloudCameraListFilter,!e._values)return console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),o.reject(CloudReturnCode.ERROR_EXPECTED_FILTER),o;if(!r||!r.isOpened())return o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o;var t=e._values();return delete filterMap.detail,r._getAPI().camerasList(t).done(function(e){o.resolve(e.objects)}).fail(function(e){CloudHelpers.handleError(e,o)}),o},o.deleteCamera=function(e){var o=CloudHelpers.promise();return r&&r.isOpened()?(r._getAPI().deleteCamera(e).done(function(){o.resolve()}).fail(function(e){CloudHelpers.handleError(e,o)}),o):(o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o)}},window.CloudSession=function(e,o){function r(e){n=e,a=e.active,l=e.title,e.preview&&(i=e.preview.url),e.live_urls&&(_=e.live_urls.rtmp,P=e.live_urls.hls,I=e.live_urls.expire),c=e.latitude,d=e.longitude,s=e.streaming,u=e.public,m=e.start,f=e.end,p=e.has_records,e.statistics&&(T=e.statistics.peak_live||0,R=e.statistics.playback||0,y=e.statistics.live||0),g=e.author?e.author.preferred_name:"unknown",e.access&&(C=-1!=e.access.indexOf("all"),v=-1!=e.access.indexOf("watch"))}var t=this;t.type="session";var n,a,l,i,s,u,c,d,m,f,p,C,v,g,_,P,I,h=e,A=o.id,y=0,T=0,R=0;i="",r(o),t._getConn=function(){return h},t._origJson=function(){return n},t.hasAccessAll=function(){return C},t.hasAccessWatch=function(){return C||v},t.getID=function(){return A},t.isOnline=function(){return a},t.getTitle=function(){return l},t.getAuthorPreferredName=function(){return g},t.getStatisticsLive=function(){return y},t.getStatisticsPeakLive=function(){return T},t.getStatisticsPlayback=function(){return R},t.getStartTime=function(){return null==m?(console.error("[CloudSession] #"+A+" Start time is null"),0):CloudHelpers.parseUTCTime(m)},t.getEndTime=function(){return null==m?(console.error("[CloudSession] #"+A+" End time is null but session is mActive: "+a),0):CloudHelpers.parseUTCTime(f)},t.getPreview=function(){return i},t.getLatitude=function(){return c},t.getLongitude=function(){return d},t.isStreaming=function(){return s},t.isPublic=function(){return u},t.hasRecords=function(){return p},t.getLiveUrl_Rtmp=function(){return _},t.getLiveUrl_HLS=function(){return P},t.getLiveUrl_Expire=function(){return I},t.refresh=function(){var e=CloudHelpers.promise();return h._getAPI().getCamsess(A).done(function(o){r(o),e.resolve()}).fail(function(o){CloudHelpers.handleError(o,e)}),e}},window.CloudSessionListFilter=function(){var e=this;e.filterParams={limit:50,order_by:"-start"},e.setLimit=function(o){e.filterParams.limit=o},e.setOffset=function(o){e.filterParams.offset=o},e.setTitle=function(o){e.filterParams.title__icontains=o},e.setStartLessThen=function(o){e.filterParams.start__lte=o},e.setHasRecords=function(o){"any"==o||("yes"==o?(e.filterParams.has_records=!0,e.filterParams.active=!1):"no"==o?(e.filterParams.has_records=!1,e.filterParams.active=!1):console.error("[CloudSessionListFilter] setHasRecords, expected 'any', 'yes' or 'no'"))},e.setStreaming=function(o){"any"==o||("yes"==o?(e.filterParams.streaming=!0,e.filterParams.camera_online=!0,e.filterParams.active=!0):"no"==o?(e.filterParams.streaming=!1,delete e.filterParams.camera_online,e.filterParams.active=!1):console.error("[CloudSessionListFilter] setStreaming, expected 'any', 'yes' or 'no'"))},e.setAuthorName=function(o){e.filterParams.author_name__icontains=o},e.setAuthorID=function(o){o?e.filterParams.author_id=o:delete e.filterParams.author_id},e.setAuthorPreferredName=function(o){o?e.filterParams.author_preferred_name__icontains=o:delete e.filterParams.author_preferred_name__icontains},e.setWithDetails=function(){console.warn("[CloudSessionListFilter] 'setWithDetails' not supported anymore. Please use getSessionList or getSessionListLight")},e.setOnline=function(){console.warn("[CloudSessionListFilter] 'setOnline' not supported anymore")},e.setPublic=function(o){"any"==o||("yes"==o?e.filterParams["public"]=!0:"no"==o?e.filterParams["public"]=!1:console.error("[CloudSessionListFilter] setOnline, expected 'any', 'yes' or 'no'"))},e.setLatLngBounds=function(o,r,t,n){r>=o?(e.filterParams.latitude__gte=o,e.filterParams.latitude__lte=r):console.error("[CloudCamerasListFilter] latitude_max must be greater or equal to latitude_min"),n>=t?(e.filterParams.longitude__gte=t,e.filterParams.longitude__lte=n):console.error("[CloudCamerasListFilter] longitude_max must be greater or equal to longitude_min")},e._values=function(){var o={};for(var r in e.filterParams)o[r]=e.filterParams[r];return o}},window.CloudSessionList=function(e){var o=this,r=e;o.getSession=function(e){var o=CloudHelpers.promise();return r&&r.isOpened()?(r._getAPI().getCamsess(e).done(function(e){o.resolve(new CloudSession(r,e))}).fail(function(e){CloudHelpers.handleError(e,o)}),o):(o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o)},o.getSessionList=function(e){var o=CloudHelpers.promise();if(e=e||new CloudSessionListFilter,!e._values)return console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),o.reject(CloudReturnCode.ERROR_EXPECTED_FILTER),o;if(!r||!r.isOpened())return o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o;var t=e._values();return t.detail="detail",r._getAPI().getCamsessList(t).done(function(e){var t=[];for(var n in e.objects)t.push(new CloudSession(r,e.objects[n]));o.resolve(t)}).fail(function(e){CloudHelpers.handleError(e,o)}),o},o.getSessionListLight=function(e){var o=CloudHelpers.promise();if(e=e||new CloudSessionListFilter,!e._values)return console.error(CloudReturnCode.ERROR_EXPECTED_FILTER),o.reject(CloudReturnCode.ERROR_EXPECTED_FILTER),o;if(!r||!r.isOpened())return o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o;var t=e._values();return delete t.detail,r._getAPI().getCamsessList(t).done(function(e){o.resolve(e.objects)}).fail(function(e){CloudHelpers.handleError(e,o)}),o},o.deleteSession=function(e){var o=CloudHelpers.promise();return r&&r.isOpened()?(r._getAPI().deleteCamsess(e).done(function(){o.resolve()}).fail(function(e){CloudHelpers.handleError(e,o)}),o):(o.reject(CloudReturnCode.ERROR_NO_CLOUD_CONNECTION),o)}},window.CloudPlayerEvent={},CloudPlayerEvent.CONNECTING={name:"CONNECTING",code:0,text:"Connection is establishing"},CloudPlayerEvent.CONNECTED={name:"CONNECTED",code:1,text:"Connection is established"},CloudPlayerEvent.PLAYED={name:"PLAYED",code:2,text:"Player changes state to PLAY."},CloudPlayerEvent.PAUSED={name:"PAUSED",code:3,text:"Player state is PAUSE."},CloudPlayerEvent.CLOSED={name:"CLOSED",code:6,text:"Player state is CLOSED."},CloudPlayerEvent.SEEK_COMPLETED={name:"SEEK_COMPLETED",code:17,text:"setPosition() is successfully finished."},CloudPlayerEvent.ERROR={name:"ERROR",code:105,text:"Player is disconnected from media stream due to an error"},CloudPlayerEvent.SOURCE_CHANGED={name:"SOURCE_CHANGED",code:3e3,text:"setSource() is successfully finished."},window._cloudPlayers=window._cloudPlayers||{},window.CloudPlayer=function(e,o){function t(){Y.style.display="none",Q.style.display="none"}function n(){1==O.mShowedBigPlayButton?a():j||(K.style.display="inline-block",j=!0)}function a(){j&&(K.style.display="none",j=!1)}function l(){CloudHelpers.isFireFox()?console.warn("in firefox not good solution for a hiding adobe flash player"):ro.style.display="block"}function i(){ro.style.display=""}function s(e){console.error(e),O._setError(e),O.showErrorText(e.text),console.error(e.text)}function u(e){function o(e,o){setTimeout(function(){L[e](o)},1)}for(var r in L)o(r,e)}function c(e){var o=e%60;e=(e-o)/60;var r=e%60;return("00"+r).slice(-2)+":"+("00"+o).slice(-2)}function d(){var e=0;"camera"==O.mSrc.type&&(e=CloudHelpers.getOffsetTimezone(O.mSrc.getTimezone()));var o=new Date;o.setTime(o.getTime()+e);var r=" "+("0000"+o.getUTCFullYear()).slice(-4)+"-"+("00"+(o.getUTCMonth()+1)).slice(-2)+"-"+("00"+o.getUTCDate()).slice(-2)+" "+("00"+o.getUTCHours()).slice(-2)+":"+("00"+o.getUTCMinutes()).slice(-2)+":"+("00"+o.getUTCSeconds()).slice(-2);return r}function m(e){var o=0;"camera"==O.mSrc.type&&(o=CloudHelpers.getOffsetTimezone(O.mSrc.getTimezone()));var r=new Date;r.setTime(e+o);var t=" "+("0000"+r.getUTCFullYear()).slice(-4)+"-"+("00"+(r.getUTCMonth()+1)).slice(-2)+"-"+("00"+r.getUTCDate()).slice(-2)+" "+("00"+r.getUTCHours()).slice(-2)+":"+("00"+r.getUTCMinutes()).slice(-2)+":"+("00"+r.getUTCSeconds()).slice(-2);return t}function f(){clearInterval(to),eo.innerHTML=""}function p(){console.warn("Start poling player time"),clearInterval(to),to=setInterval(function(){if(k&&!U){var e=0;"session_records"==lo?(e=Math.floor(co.currentTime()),e+=so[io].startUTC-uo):e="camera_records"==lo?z.startUTC+1e3*H.currentTime():"camera_live"==lo?1e3*O.vjs.currentTime():1e3*O.vjs.currentTime(),e==O.time?(n(),N++,0==O.time&&N>no?(O.stop(),s(CloudReturnCode.ERROR_STREAM_UNREACHABLE)):0!=O.time&&N>ao?(console.warn("Restart player"),O.stop(),-1!=$&&O.time>$&&($=Math.floor(O.time)),O.play()):console.warn("Wait stream "+N)):(N=0,0==O.mShowedBigPlayButton,oo.style.display="none","session_records"==lo?(O.time=e,eo.innerHTML=c(O.time)):"camera_records"==lo?(O.time=e,eo.innerHTML=m(O.time)):"camera_live"==lo?(O.time=e,eo.innerHTML=d()):(O.time=-1==$?1e3*O.vjs.currentTime():z.startUTC+1e3*O.vjs.currentTime(),eo.innerHTML=d()),a(),t()),O.isRange()&&O.time>F&&(f(),O.stop())}else a(),eo.innerHTML=""},1e3)}function C(){if(null!=z){var e=z.endUTC,o=CloudHelpers.formatUTCTime(e-5*CloudHelpers.ONE_SECOND);if(B=null,O.isRange()&&o>F)return;w._getAPI().storageRecordsFirst(O.mSrc.getID(),o,3).done(function(o){if(0==o.meta.total_count)B=null;else for(var r=o.objects.length,t=0;r>t;t++){var n=CloudHelpers.parseUTCTime(o.objects[t].start);if(n>=e&&null==B){B=o.objects[t],B.startUTC=CloudHelpers.parseUTCTime(B.start),B.endUTC=CloudHelpers.parseUTCTime(B.end),M.src([{src:B.url,type:"video/mp4"}]),M.off("loadeddata"),M.on("loadeddata",function(){M.pause()});break}}})}else B=null}function v(e){if("camera"!=O.mSrc.type)return s(CloudReturnCode.ERROR_INVALID_SOURCE),void 0;O.updateAudioCaps&&O.updateAudioCaps(O.mSrc.getID()),lo="camera_records";var o=$,r=CloudHelpers.formatUTCTime(o-2*CloudHelpers.ONE_MINUTE),t=5;w._getAPI().storageRecordsFirst(O.mSrc.getID(),r,t).done(function(t){function n(){if(console.warn("ended"),O.isRange()&&null==B)return console.warn("stop player"),a(),f(),O.stop(),void 0;if(null!=B){var e=H;H=M,M=e,H.el().style.display="",M.el().style.display="none",z=B,B=null,H.ready(function(){H.play()}),C()}}if(e!=G)return console.warn("_uniqPlay not current [[cameraLiveUrls fail]]"),void 0;var l=t.objects.length;z=null,console.log("pos = "+o),console.log("start - 2 min = "+r),i();for(var u=0;l>u;u++)if(rec=t.objects[u],rec.startUTC=CloudHelpers.parseUTCTime(rec.start),rec.endUTC=CloudHelpers.parseUTCTime(rec.end),!(o>rec.endUTC||rec.startUTC>o)&&null==z&&o>=rec.startUTC&&rec.endUTC>=o){z=rec;break}if(O.isRange()&&null==z)for(var u=0;l>u&&(rec=t.objects[u],rec.startUTC=CloudHelpers.parseUTCTime(rec.start),rec.endUTC=CloudHelpers.parseUTCTime(rec.end),!(rec.startUTC>F));u++)if(null==z&&rec.startUTC>o&&F>rec.startUTC){z=rec,o=rec.startUTC;break}return null==z?(a(),s(CloudReturnCode.ERROR_RECORDS_NOT_FOUND),f(),void 0):e!=G?(console.warn("_uniqPlay not current [[cameraLiveUrls fail]]"),void 0):O.isRange()&&o>F?(a(),f(),O.stop(),void 0):(H=O.vjs,M=O.vjs2,H.el().style.display="",M.el().style.display="none",C(),H.ready(function(){H.src([{src:z.url,type:"video/mp4"}]);var e=o-z.startUTC,r=z.endUTC-z.startUTC;console.log(e+" / "+r),H.currentTime(Math.floor(e/1e3))}),H.off("loadeddata"),H.off("ended"),M.off("ended"),H.on("ended",n),M.on("ended",n),p(),void 0)})}function g(e){e=e||O.mSrc.getID();var o=new XMLHttpRequest;o.open("GET",O.mSrc.getLiveUrl_HLS()),o.onload=function(){if(200===o.status){if(O.mSrc.getID()!=e)return;O._applyMediaTiket(O.mSrc.getLiveUrl_HLS(),O.mSrc.getLiveUrl_Expire()),O._startPolingMediaTicket(),CloudHelpers.containsPageParam("experimental_hls")?console.warn("Start experimental hls"):O.vjs.src([{src:O.mSrc.getLiveUrl_HLS(),type:"application/x-mpegURL"}]),o=null}else if(404===o.status){if(O.mSrc.getID()!=e)return console.warn("[CLOUDPLAYER] polingSessionHLSList, camid was changed stop poling hls list, currentCmaID="+O.mSrc.getID()+", camid="+e),void 0;if(N++,N>no)return O.stop(),s(CloudReturnCode.ERROR_STREAM_UNREACHABLE_HLS),void 0;setTimeout(function(){console.warn("Wait one sec "+O.mSrc.getLiveUrl_HLS()),o=null,g(e)},1e3)}else console.error("Unhandled")},o.send()}function _(){return"session"!=O.mSrc.type?(s(CloudReturnCode.ERROR_INVALID_SOURCE),void 0):(O.mSrc.refresh().done(function(){lo="session_live",CloudHelpers.useHls()?(console.log("Set url (hls): "+O.mSrc.getLiveUrl_HLS()),p(),g()):O.vjs.ready(function(){console.log("Set url (rtmp): "+O.mSrc.getLiveUrl_Rtmp()),O.vjs.options().flash.swf=CloudSDK.flashswf||"last/video-js-by-vxg-buff200.swf",O.vjs.src([{src:O.mSrc.getLiveUrl_Rtmp(),type:"rtmp/mp4"}]),l()}),O.vjs.on("ended",function(){O.stop()}),O.vjs.on("loadeddata",function(){a(),T(),R(),i()}),p()}),void 0)}function P(){so.length>io+1&&(mo.src([{src:so[io+1].url,type:"video/mp4"}]),mo.one("loadeddata",function(){mo.pause()})),co.one("ended",function(){if(io++,so.length>io){var e=co;co=mo,mo=e,co.play(),mo.el().style.display="none",co.el().style.display="",console.log("Switched players"),P()}else O.stop()})}function I(){return"session"!=O.mSrc.type?(s(CloudReturnCode.ERROR_INVALID_SOURCE),void 0):(w._getAPI().getCamsessRecords(O.mSrc.getID()).done(function(e){if(0==e.meta.total_count);else{io=0,so=e.objects,lo="session_records";for(var o in so)console.log(so[o]),so[o].startUTC=Math.floor(CloudHelpers.parseUTCTime(so[o].start)/1e3),so[o].endUTC=Math.floor(CloudHelpers.parseUTCTime(so[o].end)/1e3),0==o&&(uo=so[o].startUTC,console.log(uo));co=O.vjs,mo=O.vjs2,co.src([{src:so[io].url,type:"video/mp4"}]),P(),O.vjs.one("loadeddata",function(){a(),T(),R()}),O.vjs2.one("loadeddata",function(){a(),T(),R()}),p()}}).fail(function(e){console.error(e)}),void 0)}function h(e){return O.mSrc?(N=0,"camera"==O.mSrc.type?v(e):s(CloudReturnCode.ERROR_INVALID_SOURCE),void 0):(s(CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED),void 0)}function A(e){return e!=G?(console.warn("_uniqPlay not current [[cameraLiveUrls fail]]"),void 0):O.mSrc?(N=0,"camera"==O.mSrc.type?O._polingLoadCameraLiveUrl(e):"session"==O.mSrc.type?O.mSrc.isOnline()?_():I():(console.error("[CloudPlayer] invalid source"),O.setError(100)),void 0):(console.error("[CloudPlayer] source not set"),O.setError(100),void 0)}function y(){console.log("vjs_play, mEvent: ",S);var e=CloudHelpers.useHls()&&CloudHelpers.isSafari(),o=CloudHelpers.isIOS()||CloudHelpers.isAndroid();S||!o&&!e?(O.vjs.play(),f(),p()):(f(),N=0,console.warn("_vjs_play. is mobile. show big button"),D=!0,oo.style.display="block",oo.onclick=function(){oo.style.display="none",document.getElementById("player1_vjs_Html5_api")&&(document.getElementById("player1_vjs_Html5_api").setAttribute("webkit-playsinline",!0),document.getElementById("player1_vjs_Html5_api").setAttribute("playsinline",!0)),D=!1,N=0,O.vjs.play(),f(),p()},console.log("vjs_play "))}function T(){O.currentZoom=0,O.player.getElementsByClassName("cloudplayer-controls-zoom")[0];
var e=O.player.getElementsByClassName("cloudplayer-controls-zoom-position")[0],o=O.player.getElementsByClassName("cloudplayer-zoom-up")[0],r=O.player.getElementsByClassName("cloudplayer-zoom-down")[0],t=O.player.getElementsByClassName("cloudplayer-zoom-progress")[0],n=O.player.getElementsByClassName("cloudplayer-zoom-position-cursor")[0],a=O.player.getElementsByClassName("video-js")[0];O.setNewZoom=function(o){o>=30&&(o=30),10>=o&&(o=10),O.currentZoom!=o&&(O.currentZoom=o,a.style.transform="scale("+O.currentZoom/10+")",n.style.transform="scale("+10/O.currentZoom+")",t.className=t.className.replace(/zoom\d+x/g,"zoom"+Math.ceil(O.currentZoom)+"x"),e.style.display=10==O.currentZoom?"none":"",a.style.left="",a.style.top="",n.style.left="",n.style.top="")},O.setNewZoom(10),O.zoomCursorDownBool=!1,O.zoomCursorX=0,O.zoomCursorY=0,O.zoomCursorWidth=160,O.zoomCursorHeight=120,O.zoomControlsWidth=0,O.zoomControlsHeight=0,O.setNewZoom=function(o){o>=30&&(o=30),10>=o&&(o=10),O.currentZoom!=o&&(O.currentZoom=o,a.style.transform="scale("+O.currentZoom/10+")",n.style.transform="scale("+10/O.currentZoom+")",t.className=t.className.replace(/zoom\d+x/g,"zoom"+Math.ceil(O.currentZoom)+"x"),e.style.display=10==O.currentZoom?"none":"",a.style.left="",a.style.top="",n.style.left="",n.style.top="")},O.zoomUp=function(){O.setNewZoom(O.currentZoom+5)},O.zoomDown=function(){O.setNewZoom(O.currentZoom-5)},O.zoomProgressDownBool=!1,O.zoomProgressDown=function(){O.zoomProgressDownBool=!0},O.zoomProgressMove=function(e){if(1==O.zoomProgressDownBool){var o=e.pageY-CloudHelpers.getAbsolutePosition(e.currentTarget).y,r=t.offsetHeight,n=r/5;o=10*(Math.floor((r-o)/n)/2+1),O.setNewZoom(o)}},O.zoomProgressLeave=function(){O.zoomProgressDownBool=!1},O.zoomProgressUp=function(e){if(1==O.zoomProgressDownBool){var o=e.pageY-CloudHelpers.getAbsolutePosition(e.currentTarget).y,r=t.offsetHeight,n=r/5;o=10*(Math.floor((r-o)/n)/2+1),O.setNewZoom(o)}O.zoomProgressDownBool=!1},O.zoomCursorDown=function(o){O.zoomCursorX=o.pageX,O.zoomCursorY=o.pageY,O.zoomCursorWidth=n.offsetWidth,O.zoomCursorHeight=n.offsetHeight,O.zoomControlsWidth=e.offsetWidth,O.zoomControlsHeight=e.offsetHeight,O.zoomCursorDownBool=!0},O.zoomCursorUp=function(){console.log("zoomCursorUp"),O.zoomCursorDownBool=!1},O.zoomCursorMove=function(e){if(1==O.zoomCursorDownBool){var o=O.zoomCursorX-e.pageX,r=O.zoomCursorY-e.pageY;O.zoomCursorX=e.pageX,O.zoomCursorY=e.pageY;var t=n.offsetLeft-o,l=n.offsetTop-r,i=O.zoomControlsWidth-O.zoomCursorWidth*(10/O.currentZoom),s=O.zoomControlsHeight-O.zoomCursorHeight*(10/O.currentZoom),u=-1*i/2,c=i/2,d=-1*s/2,m=s/2;u>t&&(t=u),d>l&&(l=d),t>=c&&(t=c),l>=m&&(l=m),n.style.left=t+"px",n.style.top=l+"px";var f=O.currentZoom/10-1,p=Math.floor(-100*t/i*f),C=Math.floor(-100*l/s*f);a.style.left=p+"%",a.style.top=C+"%"}},o.onclick=O.zoomUp,r.onclick=O.zoomDown,n.addEventListener("mousedown",O.zoomCursorDown,!1),n.addEventListener("mousemove",O.zoomCursorMove,!1),n.addEventListener("mouseleave",O.zoomCursorUp,!1),n.addEventListener("mouseup",O.zoomCursorUp,!1),t.addEventListener("mousedown",O.zoomProgressDown,!1),t.addEventListener("mousemove",O.zoomProgressMove,!1),t.addEventListener("mouseleave",O.zoomProgressLeave,!1),t.addEventListener("mouseup",O.zoomProgressUp,!1)}function R(){var e=O.player.getElementsByClassName("cloudplayer-volume-mute")[0],o=O.player.getElementsByClassName("cloudplayer-volume-down")[0],r=O.player.getElementsByClassName("cloudplayer-volume-progress")[0],t=O.player.getElementsByClassName("cloudplayer-volume-up")[0];O.m=O.m||{},O.m.volume=.5,e.style.display="inline-block",O.m.mute?(o.style.display="none",r.style.display="none",t.style.display="none"):(o.style.display="inline-block",r.style.display="inline-block",t.style.display="inline-block"),O.mute=function(){O.isAudioChannelExists()&&(O.m.mute=!O.m.mute,O.m.mute?(o.style.display="none",r.style.display="none",t.style.display="none",e.style.display="inline-block",r.className=r.className.replace(/vol\d+/g,"vol0")):(o.style.display="inline-block",r.style.display="inline-block",t.style.display="inline-block",e.style.display="inline-block",r.className=r.className.replace(/vol\d+/g,"vol"+Math.floor(10*O.m.volume))),O.vjs.volume(O.m.mute?0:""+O.m.volume.toFixed(1)),O.vjs2.volume(O.m.mute?0:""+O.m.volume.toFixed(1)))},O.volume=function(e){return O.isAudioChannelExists()?void 0==e?O.m.volume:(e=e>1?1:e,e=0>e?0:e,O.m.volume=Math.ceil(10*e)/10,O.vjs.volume(O.m.mute?0:O.m.volume.toFixed(1)),O.vjs2.volume(O.m.mute?0:O.m.volume.toFixed(1)),r.className=r.className.replace(/vol\d+/g,"vol"+Math.ceil(10*O.m.volume)),void 0):void 0},O.volup=function(){O.isAudioChannelExists()&&10>Math.round(10*O.m.volume)&&(O.m.volume=O.m.volume+.1,O.vjs.volume(O.m.mute?0:O.m.volume.toFixed(1)),O.vjs2.volume(O.m.mute?0:O.m.volume.toFixed(1)),r.className=r.className.replace(/vol\d+/g,"vol"+Math.ceil(10*O.m.volume)))},O.voldown=function(){O.isAudioChannelExists()&&Math.round(10*O.m.volume)>0&&(O.m.volume=O.m.volume-.1,O.vjs.volume(O.m.mute?0:O.m.volume.toFixed(1)),O.vjs2.volume(O.m.mute?0:O.m.volume.toFixed(1)),r.className=r.className.replace(/vol\d+/g,"vol"+Math.floor(10*O.m.volume)))},e.onclick=O.mute,o.onclick=O.voldown,t.onclick=O.volup,O.vjs.ready(function(){O.isAudioChannelExists()&&(O.vjs.muted(!1),O.volume(O.m.volume))}),O.isAudioChannelExists()||(o.style.display="none",r.style.display="none",t.style.display="none",e.style.display="none")}function E(e,o){if(o!=G)return console.warn("_uniqPlay not current [_polingCameraHLSList]"),void 0;var r=new XMLHttpRequest;r.open("GET",e.hls),r.withCredentials=!0,r.onload=function(){if(o!=G)return console.warn("_uniqPlay not current [_polingCameraHLSList 2]"),void 0;if(200===r.status){if(o!=G)return;O._applyMediaTiket(e.hls,e.expire),O._startPolingMediaTicket(o),CloudHelpers.containsPageParam("experimental_hls")?console.warn("Start experimental hls"):O.vjs.src([{src:e.hls,type:"application/x-mpegURL"}]),r=null}else if(404===r.status){if(o!=G)return console.warn("[VXGCLOUDPLAYER] polingHLSList, camid was changed stop poling hls list, currentCmaID="+O.mSrc.getID()),void 0;if(N++,N>no)return s(CloudReturnCode.ERROR_STREAM_UNREACHABLE_HLS),void 0;setTimeout(function(){console.warn("Wait one sec "+e.hls),r=null,E(e,o)},1e3)}else console.error("Unhandled")},r.send()}var O=this;o=o||{},O.elid=e;var w=null,S=null,D=!1,j=!0,N=0,U=!0,k=!1,b=0,L={};if(O.timePolingLiveUrls=15e3,O.player=document.getElementById(e),_cloudPlayers[e])return _cloudPlayers[e];var H=null,M=null,x=-1,F=-1;if(videojs.options.hls=videojs.options.hls||{},videojs.options.html5.nativeAudioTracks=!1,videojs.options.html5.nativeVideoTracks=!1,videojs.options.hls.overrideNative=!0,null==O.player)return console.error("[CloudPlayer] Not found element"),null;if("DIV"!=O.player.tagName)return console.error("[CloudPlayer] Expected DIV tag but got "+O.player.tagName),null;var $=-1,z=null,B=null;O.m={},O.m.backwardAudio=!1,O.m.backwardAudio=o.backwardAudio||null!=O.player.getAttribute("backward-audio")||O.m.backwardAudio,O.defualtAutohide=CloudHelpers.isMobile()?0:3e3,O.m.autohide=o.autohide||O.defualtAutohide,O.swf_backwardaudio="",O.player.classList.add("cloudplayer"),O.player.classList.add("green"),O.player.classList.add("black"),O.player.innerHTML='<div class="cloudplayer-loader" style="display: inline-block"></div><div class="cloudplayer-screenshot-loading" style="display: none">		<div class="cloudplayer-screenshot-loading">     </div></div><div class="cloudplayer-error" style="display: none">	<div class="cloudplayer-error-text" style="display: none"></div></div><div class="cloudplayer-controls-zoom-position">		<div class="cloudplayer-zoom-position-cursor"></div></div><div class="cloudplayer-watermark"></div><div class="cloudplayer-sdkversion">SDK '+CloudSDK.version+"</div>"+'<div class="cloudplayer-info" style="display: none">'+'		<div class="cloudplayer-info-title">Settings</div>'+'		<div class="cloudplayer-info-close">X</div>'+'		<div class="cloudplayer-info-playerversion">Version: '+CloudSDK.version+" ()</div>"+'		<div class="cloudplayer-info-playertype">Used player:</div>'+'		<div class="cloudplayer-info-latency">Player Latency: '+'			<div class="cloudplayer-info-latency-minimal">Minimal Latency</div>'+"			/ "+' 		<div class="cloudplayer-info-latency-smoothless">Maximum Smoothness</div>'+"		</div>"+'		<div class="cloudplayer-info-latency-not-supported">Player Latency: Setting is not available for HTML5 player</div>'+'		<div class="cloudplayer-info-bufferlength"></div>'+'		<div class="cloudplayer-info-audio-stream">Audio stream: '+'			<div class="cloudplayer-info-audio-stream-on">On</div>'+"			/ "+' 		<div class="cloudplayer-info-audio-stream-off">Off</div>'+"		</div>"+"</div>"+'<div class="cloudplayer-backwardaudio-container">'+(O.m.backwardAudio?'<object data="'+O.swf_backwardaudio+'" type="application/x-shockwave-flash" id="backwardaudio_swf_single" align="top">'+'		<param name="movie" value="'+O.swf_backwardaudio+'" />'+'		<embed type="application/x-shockwave-flash" src="'+O.swf_backwardaudio+'">'+'		<param name="allowScriptAccess" value="always"/>'+'		<param value="allowNetworking" value="all"/>'+'		<param name="menu" value="true" />'+'		<param name="wmode" value="transparent"/>'+'		<!-- param name="bgcolor" value="#ffffff" / -->'+'		<param name="menu" value="false" />'+"</object>":"")+"</div>"+'<div class="cloudplayer-controls-zoom">'+'	<div class="cloudplayer-zoom-up"></div>'+'	<div class="cloudplayer-zoom-progress zoom10x"></div>'+'	<div class="cloudplayer-zoom-down"></div>'+"</div>"+'<div class="cloudplayer-controls">'+'	<div class="cloudplayer-volume-mute"></div>'+'	<div class="cloudplayer-volume-down"></div>'+'	<div class="cloudplayer-volume-progress vol7"></div>'+'	<div class="cloudplayer-volume-up"></div>'+'	<div class="cloudplayer-play" style="display: none"></div>'+'	<div class="cloudplayer-stop" style="display: none"></div>'+'	<div class="cloudplayer-microphone"></div>'+'	<div class="cloudplayer-time"></div>'+'	<div class="cloudplayer-fullscreen"></div>'+"</div>"+'<div class="cloudplayer-big-play-button" style="display: none"></div>'+'<video crossorigin="anonymous" id="'+e+'_vjs" class="video-js" preload="auto" class="video-js vjs-default-skin vjs-live"'+' muted=true autoplay=true preload playsinline="true"></video>'+'<video crossorigin="anonymous" id="'+e+'_vjs2" class="video-js" preload="auto" class="video-js vjs-default-skin vjs-live"'+' muted=true autoplay=true preload playsinline="true" ></video>'+'<video crossorigin="anonymous" id="'+e+'_hls" class="cloudplayer-hls"'+' autoplay=true preload  playsinline="true" ></video>'+'<div class="cloudplayer-black-screen" style="display: none">'+'		<div class="cloudplayer-watermark"></div>'+'		<div class="cloudplayer-sdkversion">SDK '+CloudSDK.version+"</div>"+"</div>",O.vjs=videojs(e+"_vjs",{controls:!1}),O.vjs2=videojs(e+"_vjs2",{controls:!1}).ready(function(){O.vjs2.el().style.display="none"}),O.vjs.on("error",function(){if(a(),null!=O.vjs.error()){var e=O.vjs.error();4!=e.code||CloudHelpers.supportFlash()||CloudHelpers.isMobile()?3==e.code&&CloudHelpers.isMobile()?s(CloudReturnCode.ERROR_COULD_NOT_DECODE_STREAM_OR_COULD_NOT_SET_COOKIE_HLS):s({name:"VIDEOJS_ERROR",text:"Code "+e.code+": "+e.message,code:-6e3}):s({name:"REQUIRE_FLASH",text:"Please install and enable <a target='_black' href='https://get.adobe.com/flashplayer/'>Adobe Flash Player</a> and try again",code:-6001})}O.stop()});var G=null;O.time=0;var V=O.player.getElementsByClassName("cloudplayer-controls")[0],Z=O.player.getElementsByClassName("cloudplayer-controls-zoom")[0],q=O.player.getElementsByClassName("cloudplayer-controls-zoom-position")[0],J=O.player.getElementsByClassName("cloudplayer-play")[0],W=O.player.getElementsByClassName("cloudplayer-info")[0],X=O.player.getElementsByClassName("cloudplayer-stop")[0],K=O.player.getElementsByClassName("cloudplayer-loader")[0],Y=O.player.getElementsByClassName("cloudplayer-error")[0],Q=O.player.getElementsByClassName("cloudplayer-error-text")[0],eo=O.player.getElementsByClassName("cloudplayer-time")[0],oo=O.player.getElementsByClassName("cloudplayer-big-play-button")[0],ro=O.player.getElementsByClassName("cloudplayer-black-screen")[0];a();var to,no=60,ao=15,lo=null,io=0,so=null,uo=null,co=null,mo=null;O.showErrorText=function(e){a(),Y.style.display="inline-block",Q.style.display="inline-block",Q.innerHTML=e,i()},O.setSource=function(e){if(t(),O.mSrc=e,null==O.mSrc?(J.style.display="none",w=null):(J.style.display="inline-block",w=e._getConn()),O.isRange()){var o=CloudHelpers.getCurrentTimeUTC();o>x&&F>o?O.setPosition(CloudPlayer.POSITION_LIVE):O.setPosition(x)}else O.setPosition(CloudPlayer.POSITION_LIVE);u(CloudPlayerEvent.SOURCE_CHANGED)},O.getSource=function(){return O.mSrc},O.removeCallback=function(e){delete L[e]},O.addCallback=function(e,o){return"function"!=typeof o?(console.error("Second parameter expected function"),void 0):(L[e]&&(console.warn(e+" - already registered callback, will be removed before add"),O.removeCallback(e)),L[e]=o,void 0)},O.play=function(e){return k&&O.stop(),"camera"!=O.mSrc.type&&"session"!=O.mSrc.type?(s(CloudReturnCode.ERROR_INVALID_SOURCE),void 0):(G=Math.random(),S=e,console.warn("mUniqPlay: "+G),X.style.display="inline-block",J.style.display="none",U=!1,k=!0,f(),p(),O._reset_vjs(),t(),-1==$?A(G):(console.warn("Try load records from "+CloudHelpers.formatUTCTime($)),h(G)),n(),void 0)},O.setPosition=function(e){O.time=0,$=e},O.getPosition=function(){return k?-1==$?O.vjs&&0!=O.vjs.currentTime()?CloudHelpers.getCurrentTimeUTC()+(w?w.getServerTimeDiff():0):0:0==O.time?$:Math.floor(O.time):0},O.stop=function(){G=null,U=!0,k=!1,O._reset_vjs(),X.style.display="none",J.style.display="inline-block",f(),O._stopPolingMediaTicket(),a()},O.close=function(){O.stop(),clearInterval(O.currentTime)},O.error=function(){return O.mLastError||-1},O._setError=function(e){setTimeout(O.stop,10),O.mLastError=e,O.mCallback_onError&&O.mCallback_onError(O,e)},O.setRange=function(e,o){console.warn("[PLAYER] setRange"),x=e,F=o},O.isRange=function(){return-1!=x&&-1!=F},O.resetRange=function(){console.warn("[PLAYER] resetRange"),x=-1,F=-1},T(),O.isAudioChannelExists=function(){return!0},O.updateAudioStream=function(){el_info_audio_stream.style.display="none",console.log("api: ",w._getAPI()),w._getAPI().cameraMediaStreams(O.currentCamID).done(function(e){if(console.log("cameraMediaStreams: ",e),e.mstreams_supported&&e.mstreams_supported.length>1){el_info_audio_stream.style.display="block",O.mstreams.audio_on="",O.mstreams.audio_off="",O.mstreams.current=e.live_ms_id;for(var o in e.mstreams_supported)e.mstreams_supported[o].as_id&&e.mstreams_supported[o].vs_id?O.mstreams.audio_on=e.mstreams_supported[o].id:e.mstreams_supported[o].vs_id&&(O.mstreams.audio_off=e.mstreams_supported[o].id);O.mstreams.audio_on==O.mstreams.current?el_info_audio_stream_on.classList.add("selected"):O.mstreams.audio_off==O.mstreams.current&&el_info_audio_stream_off.classList.add("selected")}else el_info_audio_stream.style.display="none";!O.isAudioChannelExists()}).fail(function(e){console.error(e),el_info_audio_stream.style.display="none"})},R(),O._polingLoadCameraLiveUrl=function(e){return e!=G?(console.warn("_uniqPlay not current [_polingLoadCameraLiveUrl]"),void 0):"camera"!=O.mSrc.type?(s(CloudReturnCode.ERROR_INVALID_SOURCE),void 0):(O.updateAudioCaps&&O.updateAudioCaps(O.mSrc.getID()),lo="camera_live",w._getAPI().cameraLiveUrls(O.mSrc.getID()).done(function(o){return e!=G?(console.warn("_uniqPlay not current [_polingLoadCameraLiveUrl.done]"),void 0):(CloudHelpers.useHls()?(console.log("Set url (hls): "+o.hls),E(o,e)):O.vjs.ready(function(){console.log("Set url (rtmp): "+o.rtmp),O.vjs.options().flash.swf=CloudSDK.flashswf||"last/video-js-by-vxg-buff200.swf",O.vjs.src([{src:o.rtmp,type:"rtmp/mp4"}]),l()}),O.vjs.off("ended"),O.vjs.on("ended",function(){O.stop()}),O.vjs.off("loadeddata"),O.vjs.on("loadeddata",function(){return console.warn("loadeddata"),i(),e!=G?(console.warn("_uniqPlay not current [loadeddata]"),void 0):(a(),T(),R(),y(),void 0)}),O.vjs.play(),f(),p(),void 0)}).fail(function(o){return console.error(o),e!=G?(console.warn("_uniqPlay not current [_polingLoadCameraLiveUrl.fail]"),void 0):o.status&&503==o.status?(N++,O.timePolingLiveUrls>N?setTimeout(function(){O._polingLoadCameraLiveUrl(e)},1e3):console.error(o),void 0):(console.error(o),void 0)}),void 0)},O._reset_vjs=function(){O.vjs.reset(),O.vjs.controls(!1),O.vjs.muted(!1),O.vjs.autoplay(!0),O.vjs.volume(.5),O.vjs.el().style.display="",O.vjs2.reset(),O.vjs2.controls(!1),O.vjs2.muted(!1),O.vjs2.autoplay(!0),O.vjs2.volume(.5),O.vjs2.el().style.display="none",O.volume(O.m.volume),f(),O._stopPolingMediaTicket()},O.isPlaying=function(){return k},O.set_controls_opacity=function(e){V.style.opacity=e,Z.style.opacity=e,q.style.opacity=e,W.style.opacity=e},O.restartTimeout=function(){return 0>O.m.autohide?(O.set_controls_opacity("0"),void 0):0==O.m.autohide?(O.set_controls_opacity("0.7"),void 0):(O.set_controls_opacity("0.7"),clearTimeout(O.timeout),O.timeout=setTimeout(function(){O.set_controls_opacity("0")},O.m.autohide),void 0)},O.player.addEventListener("mousemove",O.restartTimeout,!0),O.player.addEventListener("touchmove",O.restartTimeout,!0),O.player.addEventListener("touchstart",O.restartTimeout,!0),O.restartTimeout(),J.onclick=O.play,X.onclick=O.stop,O.size=function(){console.error("[CloudPlayer] size not support")},O.initFullscreenControls=function(){var e,o,r=O.player.getElementsByClassName("cloudplayer-fullscreen")[0];O.changedFullscreen=function(){console.log("changedFullscreen"),document.webkitIsFullScreen?(e=O.player.style.height,o=O.player.style.width,O.player.style.height="100%",O.player.style.width="100%",console.log("changedFullscreen -> fullscreen")):(O.player.style.height=e,O.player.style.width=o,console.log("changedFullscreen -> NOT fullscreen"))},document.addEventListener&&(document.addEventListener("webkitfullscreenchange",O.changedFullscreen,!1),document.addEventListener("mozfullscreenchange",O.changedFullscreen,!1),document.addEventListener("fullscreenchange",O.changedFullscreen,!1),document.addEventListener("MSFullscreenChange",O.changedFullscreen,!1)),O.fullscreen=function(){console.log("fullscreen: clicked"),1==document.webkitIsFullScreen?document.webkitCancelFullScreen():document.mozFullScreen?document.mozCancelFullScreen():document.msFullscreenElement&&null!=document.msFullscreenElement?document.msExitFullscreen():O.player.mozRequestFullScreen?O.player.mozRequestFullScreen():O.player.requestFullscreen?O.player.requestFullscreen():O.player.webkitRequestFullscreen?O.player.webkitRequestFullscreen():O.player.msRequestFullscreen&&O.player.msRequestFullscreen()},r.onclick=O.fullscreen},O.initFullscreenControls(),O.initHLSMechanism=function(){O._applyMediaTiket=function(e,o){console.log("media-tiсket: old = "+O.hls_mediaticket_value),-1!=e.indexOf("?")&&(O.hls_mediaticket_value="?"+e.split("?")[1]),b=Date.parse(o+"Z"),console.log("media-tiсket: new = "+O.hls_mediaticket_value)},O._stopPolingMediaTicket=function(){clearInterval(O._polingMediaTicketInterval)},O._startPolingMediaTicket=function(e){return O._stopPolingMediaTicket(),console.warn("_startPolingMediaTicket"),e!=G?(console.warn("_uniqPlay not current [_startPolingMediaTicket]"),void 0):videojs.Hls?(videojs.Hls.xhr.beforeRequest=function(e){if(e.uri.indexOf(".ts")+3==e.uri.length)return e.uri+=O.hls_mediaticket_value,e.uri=e.uri,e;if(-1!=e.uri.indexOf("?")){var o=e.uri.split("?")[0];if(o.indexOf(".m3u8")+5==o.length)return e.uri=o+O.hls_mediaticket_value,e.uri=e.uri,e}return e},O._polingMediaTicketInterval=setInterval(function(){if(!k)return O._stopPolingMediaTicket(),void 0;if(e!=G)return console.warn("_polingMediaTicketInterval [_uniqPlay]"),void 0;var o=(new Date).getTime()+w.getServerTimeDiff(),t=b-o;t=Math.round(t/1e3),30>t&&(console.log("media-tiсket: Updating"),"camera"==O.mSrc.type?w._getAPI().cameraLiveUrls(O.mSrc.getID()).done(function(o){return e!=G?(console.warn("_uniqPlay not current [cameraLiveUrls done]"),void 0):(O._applyMediaTiket(o.hls,o.expire),console.log("media-tiсket: Updated"),void 0)}).fail(function(o){return 0!=o.status&&(console.error("media-tiсket: stop poling ",o),O._stopPolingMediaTicket()),e!=G?(console.warn("_uniqPlay not current  [cameraLiveUrls fail]"),void 0):void 0}):"session"==O.mSrc.type&&O.mSrc.refresh().done(function(){O._applyMediaTiket(O.mSrc.getLiveUrl_HLS(),O.mSrc.getLiveUrl_Expire()),O._startPolingMediaTicket()}).fail(function(e){0!=e.status&&(console.error("media-tiсket: stop poling ",r),O._stopPolingMediaTicket())}))},1e4),void 0):(console.error("Not found hls plugin"),s(CloudReturnCode.ERROR_NOT_FOUND_HLS_PLUGIN),void 0)}},O.initHLSMechanism(),window._cloudPlayers[e]=O},CloudPlayer.POSITION_LIVE=-1,window.CloudCameraTimelineMode={},CloudCameraTimelineMode.MINUTES_MODE={name:"MINUTES_MODE",code:0},CloudCameraTimelineMode.HOUR_MODE={name:"HOUR_MODE",code:1},CloudCameraTimelineMode.HOURS_12_MODE={name:"HOURS_12_MODE",code:2},window.CloudCameraTimelineView=function(e){function o(e){if(null==e||"object"!=typeof e)return e;var o=e.constructor();for(var r in e)e.hasOwnProperty(r)&&(o[r]=e[r]);return o}function r(){E!=x.offsetWidth&&(E=x.offsetWidth),O=E/(P.right_border-P.left_border),w=(P.right_border-P.left_border)/E}function t(e){var o=e;return o-=o%1e3,o-=o%A}function n(){clearInterval(P._polingCursor)}function a(){if(null!=I&&"camera"==I.type){var e=I.getID(),o=CloudHelpers.formatUTCTime(j);h._getAPI().storageRecordsFirst(e,o,1).done(function(e){for(var o in e.objects){var r=e.objects[o],n=CloudHelpers.parseUTCTime(r.start),a=CloudHelpers.parseUTCTime(r.end),l=t(n);t(a),y[l]||(y[l]={status:1,data:[]});var i=0,s=0;for(var u in y[l].data){var c=y[l].data[u];c.end>s&&(s=c.end),n>c.start&&c.end>n-2e3&&(a>c.end?(y[l].data[u].end=a,i=1,P._eventRedrawTimeline()):i=2)}if(0==i&&a>s){var c={start:n,end:a};y[l].data.push(c),P._eventRedrawTimeline()}a>j&&(j=a+CloudHelpers.ONE_SECOND)}})}}function l(){clearInterval(D)}function i(){clearInterval(D),j=CloudHelpers.getCurrentTimeUTC()-CloudHelpers.ONE_MINUTE,D=setInterval(a,3e4)}function s(e){return Math.floor((e-P.left_border)*O)}function u(){if(P.left_border-1e3>T||T>P.right_border+1e3)return"none"!=M.style.display&&(M.style.display="none"),void 0;if("inline-block"!=M.style.display&&(M.style.display="inline-block"),0!=T){var e=s(T);if(e>-5&&E>e){var o=b?2:50;M.style.left=e+o+"px"}else"none"!=M.style.display&&(M.style.display="none")}else"none"!=M.style.display&&(M.style.display="none")}function c(){n(),P._polingCursor=setInterval(function(){T=0!=N?N.getPosition():0,u()},1e3)}function d(e,o){var r=t(e),n=t(o)+A;if(r>n)return console.error("[ERROR] start must be more than end"),!1;for(var a=!0,l=r;n>=l;l+=A)y[l]?1!=y[l].status&&(a=!1):a=!1;return a}function m(){P.el_data.innerHTML="";var e=t(P.left_border),o=t(P.right_border)+A;if(e>o)return console.error("[ERROR] start must be more than end"),!1;if(P.isRange()){if(mRangeMin_Normalize>e)return console.error("[ERROR] Going beyond the range (start)"),!1;if(o>mRangeMax_Normalize)return console.error("[ERROR] Going beyond the range (end)"),!1}for(var r=e;o>=r;r+=A){var n=y[r];if(n&&1==n.status)for(var a=0;n.data.length>a;a++){var l=s(n.data[a].start),i=s(n.data[a].end),u='<crect style="left: '+l+"px; width: "+(i-l)+'px"></crect>';P.el_data.innerHTML+=u}}}function f(e){var o=CloudHelpers.promise(),r=y[e];return r&&1==r.status?(o.resolve(),o):(null!=I?(y[e]={},y[e].status=0,y[e].data=[],I.getTimeline(e,e+A).done(function(o){y[e]&&(y[e].status=1,y[e].data=o.periods),m()}).fail(function(){y[e]&&(y[e].status=-1),o.reject()})):o.reject(),o)}function p(e,o){var r=t(e),n=t(o)+A;if(r>n)return console.error("[ERROR] start must be more than end"),!1;if(P.isRange()){if(mRangeMin_Normalize>e)return console.error("[ERROR] Going beyond the range (left)"),!1;if(n>mRangeMax_Normalize)return console.error("[ERROR] Going beyond the range (right)"),!1}if(null!=I)for(var a=r;n>=a;a+=A){var l=y[a];(!l||l&&-1==l.status)&&f(a)}}function C(){console.warn("_disposeTimeline"),y={},n(),l(),j=0}function v(){console.warn("_changedSource"),null!=N?(I=N.getSource(),I?(C(),h=I._getConn(),c(),i()):(h=null,I=null,C())):(I=null,C()),P.redrawTimeline()}function g(e){console.warn("_playerEvent ",e),"SOURCE_CHANGED"==e.name&&v()}function _(e){if(null==N)return console.log("[CloudCameraTimeline] player is null"),void 0;if(null==I)return console.log("[CloudCameraTimeline] source is null"),void 0;if($==z){var o=e.currentTarget.getBoundingClientRect(),r=e.clientX-o.left,t=Math.floor(r*w);t+=P.left_border,t>=CloudHelpers.getCurrentTimeUTC()&&N?(N.stop(),N.setPosition(CloudPlayer.POSITION_LIVE),N.play(),u()):t&&N?(N.stop(),N.setPosition(t),N.play(),u()):u()}}var P=this,I=null,h=null,A=108e5,y={},T=0,R=!1,E=0,O=0,w=0,S=e,D=null,j=0,N=null,U=-1,k=-1,b=!1,L={};L.HOURS_12_MODE={len_ms:324e5,step_short:18e5,step_long:9e6},L.HOUR_MODE={len_ms:54e5,step_short:3e5,step_long:18e5},L.MINUTES_MODE={len_ms:9e5,step_short:6e4,step_long:3e5};var H=o(L.MINUTES_MODE);if(P.elem=document.getElementById(e),null==P.elem)return console.error("[CloudCameraTimeline] Not found element"),null;if("DIV"!=P.elem.tagName)return console.error("[CloudCameraTimeline] Expected DIV tag but got "+P.elem.tagName),null;P.elem.classList.add("cloudcameratimeline"),P.elem.classList.add("green"),P.elem.classList.add("black"),P.elem.innerHTML='<div class="cloudcameratimeline-left"></div><div class="cloudcameratimeline-content">		<div class="cloudcameratimeline-scale"></div>		<div class="cloudcameratimeline-data"></div>		<div class="cloudcameratimeline-cursor"></div></div></div><div class="cloudcameratimeline-right"></div>',P.left_border=Math.floor(CloudHelpers.getCurrentTimeUTC()-H.len_ms/2),P.right_border=Math.floor(P.left_border+H.len_ms),P.el_data=P.elem.getElementsByClassName("cloudcameratimeline-data")[0];var M=P.elem.getElementsByClassName("cloudcameratimeline-cursor")[0],x=P.elem.getElementsByClassName("cloudcameratimeline-scale")[0];P.el_prev=P.elem.getElementsByClassName("cloudcameratimeline-left")[0],P.el_next=P.elem.getElementsByClassName("cloudcameratimeline-right")[0],r(),P.setPlayer=function(e){C(),N&&N.removeCallback(S),e?(N=e,v(),N.addCallback(S,g)):(N=null,v())},P.setRange=function(e,n){console.warn("[TIMELINE] setRange todo"),U=e,k=n,mRangeMin_Normalize=t(e),mRangeMax_Normalize=t(n)+A,r(),P.elem.classList.add("range");var a=k-U,l=U,i=k,s=L.HOUR_MODE.len_ms;if(s>=a)P.elem.classList.add("hide-nav-arrows"),b=!0;else{i=U+s;var u=CloudHelpers.getCurrentTimeUTC();k>u&&u>U&&u>i&&(i=u+Math.floor(s/2),i>k&&(i=k),l=i-s)}var c=o(L.HOUR_MODE);P.animationTo(l,i,c)},P.isRange=function(){return-1!=U&&-1!=k},P.resetRange=function(){console.warn("[TIMELINE] resetRange"),U=-1,k=-1,b=!1,P.elem.classList.remove("range"),r()},P.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"],P.dateFormat=function(e,o){var r="";if(P.isRange()){var e=Math.floor((e-U)/1e3),t=e%60;e=(e-t)/60;var n=e%60,a=(e-n)/60,r=("00"+a).slice(-2)+":"+("00"+n).slice(-2)}else{var l=new Date;l.setTime(e);var r=("00"+l.getUTCHours()).slice(-2)+":"+("00"+l.getUTCMinutes()).slice(-2);o&&(r+=" ("+l.getUTCDate()+" "+P.months[l.getUTCMonth()]+")")}return r},P._eventRedrawTimeline=function(){setTimeout(P.redrawTimeline,10)},P.redrawTimeline=function(){if(R)return console.warn("redrawTimeline busy"),void 0;R=!0,r();var e=Math.floor(P.left_border/H.step_short),o=Math.floor(P.right_border/H.step_short)+1;P.isRange()&&(U>=P.left_border?P.el_prev.classList.add("disabled"):P.el_prev.classList.remove("disabled"),P.right_border>=k?P.el_next.classList.add("disabled"):P.el_next.classList.remove("disabled")),P.el_data.innerHTML="",x.innerHTML='<vtext id="texttimelinetest"><vtext>';var t=document.getElementById("texttimelinetest");t.innerHTML=P.dateFormat(P.left_border,!1);var n=t.clientWidth;t.innerHTML=P.dateFormat(P.left_border,!0);for(var a=t.clientWidth,l=H.step_long;n*w>l;)l+=H.step_long;var i=2*l;x.innerHTML+="<hline></hline>";for(var c=e;o>c;c++){var f=c*H.step_short,C=s(f);if(0==f%H.step_long){var v=0==f%i,g=v?a:n,_=C-g/2;x.innerHTML+='<vline style="left: '+C+'px"></vline>',0==f%l&&(x.innerHTML+='<vtext style="left: '+_+'px">'+P.dateFormat(f,v)+"</vtext>")}else x.innerHTML+='<vlineshort style="left: '+C+'px"></vline>'}if(P.el_data.innerHTML="",u(),null!=I)if(d(P.left_border,P.right_border))m();else{if(P.isRange()&&(mRangeMin_Normalize>P.left_border||P.right_border>mRangeMax_Normalize))return R=!1,void 0;p(P.left_border,P.right_border)}R=!1},P.redrawTimeline(),window.addEventListener("resize",function(){console.warn("resize")}),P.animationTo=function(e,r,t){function n(){P.left_border=Math.floor(d[A].left),P.right_border=Math.floor(d[A].right),c&&(H.step_short=Math.floor(d[A].step_short),H.step_long=Math.floor(d[A].step_long)),P.redrawTimeline(),A++,a>A?setTimeout(n,10):(c&&(H=o(t)),P.left_border=e,P.right_border=r,P.redrawTimeline())}t=t||H;var a=25,l=e-P.left_border,i=r-P.right_border;if(0==l&&0==i)return console.warn("Already in current position"),P.redrawTimeline(),void 0;var s=t.step_short-H.step_short,u=t.step_long-H.step_long,c=0!=s&&0!=u;P.left_border,P.right_border;for(var d=[],m=3.14/a,f=0,p=0;a>p;p++){var C=Math.sin(p*m);f+=C,d.push({k:C})}var v=l/f,g=i/f,_=s/f,I=u/f,h=d[0].k;d[0].left=P.left_border+h*v,d[0].right=P.right_border+h*g,c&&(d[0].step_short=H.step_short+h*_,d[0].step_long=H.step_long+h*I);for(var p=1;a>p;p++){var C=d[p].k;d[p].left=d[p-1].left+C*v,d[p].right=d[p-1].right+C*g,c&&(d[p].step_short=d[p-1].step_short+C*_,d[p].step_long=d[p-1].step_short+C*I)}d[a-1].left=e,d[a-1].right=r;var A=0;setTimeout(n,15)},P.fixBorderLimit=function(e,o){var r={};if(r.left=e,r.right=o,P.isRange())r.right>k&&(r.right=k,r.left=r.right-H.len_ms),U>r.left&&(r.left=U,r.right=r.left+H.len_ms);else{var t=CloudHelpers.getCurrentTimeUTC()+H.len_ms/2;if(r.right>t){var n=r.right-t;r.left=r.left-n,r.right=r.right-n}}return r},P.moveToRight=function(){var e=P.right_border-P.left_border;e=Math.floor(.75*e);var o=P.left_border+e,r=P.right_border+e,t=P.fixBorderLimit(o,r);P.animationTo(t.left,t.right)},P.el_next.onclick=P.moveToRight,P.moveToLeft=function(){var e=P.right_border-P.left_border;e=Math.floor(.75*e);var o=P.left_border-e,r=P.right_border-e,t=P.fixBorderLimit(o,r);P.animationTo(t.left,t.right)},P.el_prev.onclick=P.moveToLeft,P.moveToPosition=function(e){var o=Math.floor((P.right_border-P.left_border)/2);P.animationTo(e-o,e+o)};var F=!1,$=0,z=0;P.mousedown=function(e){$=e.offsetX,z=e.offsetX,F=!0},P.mousemove=function(e){if(F&&!P.isRange()){var o=e.offsetX-z;if(0!=o){var r=Math.floor(o*w);z=e.offsetX;var t=P.fixBorderLimit(P.left_border-r,P.right_border-r);P.left_border=t.left,P.right_border=t.right,P.redrawTimeline()}}},P.mouseup=function(){F=!1},P.el_data.addEventListener("mousedown",P.mousedown),P.el_data.addEventListener("mousemove",P.mousemove),P.el_data.addEventListener("mouseup",P.mouseup),P.el_data.addEventListener("mouseout",P.mouseup),P.el_data.onclick=_,P.setMode=function(e){var r=null;if(!L[e.name])return console.error("Unknown timeline mode"),-1;r=L[e.name];var t=(P.right_border-P.left_border)/2+P.left_border,n=o(r),a=r.len_ms/2;return P.animationTo(t-a,t+a,n),0},P.getMode=function(){return H}},window.CloudSessionTimeline=function(e){function o(e){if(null==e||"object"!=typeof e)return e;var o=e.constructor();for(var r in e)e.hasOwnProperty(r)&&(o[r]=e[r]);return o}function r(){clearInterval(n._polingCursor)}function t(){r(),n._polingCursor=setInterval(function(){var e=n.plr.getPosition();if((n.left_border>e||e>n.right_border)&&"none"!=s.style.display&&(s.style.display="none"),"inline-block"!=s.style.display&&(s.style.display="inline-block"),0!=e){var o=n.calcPosition(e)+50+"px";s.style.left=o}},1e3)}var n=this,a=null,l={};l.h12={to:"min",len_ms:324e5,step_short:18e5,step_long:9e6},l.hr={to:"h12",len_ms:54e5,step_short:3e5,step_long:18e5},l.min={to:"hr",len_ms:9e5,step_short:6e4,step_long:3e5};
var i=o(l.min);if(n.elem=document.getElementById(e),null==n.elem)return console.error("[CloudPlayerTimeline] Not found element"),null;if("DIV"!=n.elem.tagName)return console.error("[CloudPlayerTimeline] Expected DIV tag but got "+n.elem.tagName),null;n.elem.classList.add("cloudplayertimeline"),n.elem.classList.add("green"),n.elem.classList.add("black"),n.elem.innerHTML='<div class="cloudplayertimeline-content">		<div class="cloudplayertimeline-scale session"></div>		<div class="cloudplayertimeline-data session"></div>		<div class="cloudplayertimeline-cursor"></div></div>',n.left_border=CloudHelpers.getCurrentTimeUTC()-i.len_ms/2,n.right_border=n.left_border+i.len_ms,n.el_data=n.elem.getElementsByClassName("cloudplayertimeline-data")[0];var s=n.elem.getElementsByClassName("cloudplayertimeline-cursor")[0];n.el_scale=n.elem.getElementsByClassName("cloudplayertimeline-scale")[0],n.setPlayer=function(e){r(),n.plr=e,n.plr&&t()},n.calcPosition=function(e){return Math.floor((e-n.left_border)*n.distPx)},n.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"],n.dateFormat=function(e,o){var r=new Date;r.setTime(e);var t=("00"+r.getUTCHours()).slice(-2)+":"+("00"+r.getUTCMinutes()).slice(-2);return o&&(t+=" ("+r.getUTCDate()+" "+n.months[r.getUTCMonth()]+")"),t},n.redrawTimeline=function(){a=null!=n.plr?n.plr.getSource():null,null!=a&&(n.left_border=a.getStartTime(),n.right_border=a.getEndTime(),i.step_short=(n.right_border-n.left_border)/20),s.style.display="none",n.containerWidth=n.el_scale.offsetWidth,n.distPx=n.containerWidth/(n.right_border-n.left_border),n.distSec=(n.right_border-n.left_border)/n.containerWidth;var e=Math.floor(n.left_border/i.step_short),o=Math.floor(n.right_border/i.step_short)+1;n.el_data.innerHTML="",n.el_scale.innerHTML='<vtext id="texttimelinetest"><vtext>';var r=document.getElementById("texttimelinetest");r.innerHTML=n.dateFormat(n.left_border,!1);var t=r.clientWidth;r.innerHTML=n.dateFormat(n.left_border,!0);for(var l=r.clientWidth,u=i.step_long;t*n.distSec>u;)u+=i.step_long;var c=2*u;n.el_scale.innerHTML+="<hline></hline>";for(var d=e;o>d;d++){var m=d*i.step_short,f=n.calcPosition(m);if(0==m%i.step_long){var p=0==m%c,C=p?l:t,v=f-C/2;n.el_scale.innerHTML+='<vline style="left: '+f+'px"></vline>',0==m%u&&(n.el_scale.innerHTML+='<vtext style="left: '+v+'px">'+n.dateFormat(m,p)+"</vtext>")}else n.el_scale.innerHTML+='<vlineshort style="left: '+f+'px"></vline>'}n.el_data.innerHTML="",null!=a&&a.getTimeline(n.left_border,n.right_border).done(function(e){var o=e.periods;n.el_data.innerHTML="";for(var r=0;o.length>r;r++){var t=n.calcPosition(o[r].start),a=n.calcPosition(o[r].end),l='<crect style="left: '+t+"px; width: "+(a-t)+'px"></crect>';n.el_data.innerHTML+=l}}).fail(function(e){console.error(e)})},n.redrawTimeline(),window.addEventListener("resize",n.redrawTimeline),n.animationTo=function(e,r,t){function a(){n.left_border+=f[h],n.right_border+=p[h],m&&(i.step_short+=C[h],i.step_long+=v[h]),n.redrawTimeline(),h++,l>h?setTimeout(a,10):(m&&(i=o(t)),n.redrawTimeline())}t=t||i;for(var l=25,s=e-n.left_border,u=r-n.right_border,c=t.step_short-i.step_short,d=t.step_long-i.step_long,m=0!=c&&0!=d,f=[],p=[],C=[],v=[],g=3.14/l,_=0,P=0;l>P;P++){var I=Math.sin(P*g);_+=I}for(var P=0;l>P;P++){var I=Math.sin(P*(3.14/l));f.push(I*(s/_)),p.push(I*(u/_)),m&&(C.push(I*(c/_)),v.push(I*(d/_)))}var h=0;setTimeout(a,15)},n.fixBorderLimit=function(e,o){var r={};r.left=e,r.right=o;var t=CloudHelpers.getCurrentTimeUTC()+i.len_ms/2;if(r.right>t){var n=r.right-t;r.left=r.left-n,r.right=r.right-n}return r},n._clickOnData=function(e){if(null==n.plr)return console.log("[CloudCameraTimeline] player is null"),void 0;if(null==a)return console.log("[CloudCameraTimeline] source is null"),void 0;var o=Math.floor(e.offsetX*n.distSec);o+=n.left_border,o&&n.plr&&(n.plr.stop(),n.plr.setPosition(o),n.plr.play())},n.el_data.onclick=n._clickOnData,n._startMove=!1,n._lastMoveX=0,n.mousedown=function(e){n._lastMoveX=e.offsetX,n._startMove=!0,n.el_data.style.cursor="move"},n.mousemove=function(e){if(n._startMove){var o=e.offsetX-n._lastMoveX;if(0!=o){var r=Math.floor(o*n.distSec);n._lastMoveX=e.offsetX;var t=n.fixBorderLimit(n.left_border-r,n.right_border-r);n.left_border=t.left,n.right_border=t.right,n.redrawTimeline()}}},n.mouseup=function(){n._startMove=!1,n.el_data.style.cursor="default"},n.el_data.addEventListener("mousedown",n.mousedown),n.el_data.addEventListener("mousemove",n.mousemove),n.el_data.addEventListener("mouseup",n.mouseup),n.el_data.addEventListener("mouseout",n.mouseup)},window.CloudSDK=window.CloudSDK||{},CloudSDK.version="2.0.36",CloudSDK.datebuild="180305",console.log("CloudSDK.version="+CloudSDK.version+"_"+CloudSDK.datebuild),window.CloudPlayerSDK=function(e,o){console.log(o);var r=this;if(r.options=o||{},r.player=null,r.conn=null,r.filter=null,r.cm=null,r.mCameraID=null,r.camera=null,r.svcp_url=null,r.sharedKey=null,r.playerElementID=null,window._CloudPlayerSDK=window._CloudPlayerSDK||{},!e||""===e)throw"Player container element ID is required.";if(r.playerElementID=e,-1===r.playerElementID.indexOf("%")&&(r.playerElementID=encodeURIComponent(r.playerElementID)),r.conn=new CloudShareConnection,window._CloudPlayerSDK[e])throw"Oops! CloudPlayerSDK instance with player element ID: "+e+" already exist. Try use another ID.";window._CloudPlayerSDK[e]={},r.player=new CloudPlayer(e),console.log("self.options: ",r.options),r.options.timeline&&(r.timeline=new CloudCameraTimelineView(r.options.timeline),r.timeline.setPlayer(r.player)),r.setSource=function(e){if(!e||""===e){var o="Access token required";return console.error(o),r.player.showErrorText(o),CloudReturnCode.ERROR_INVALID_SOURCE}try{var t=atob(e);t=JSON.parse(t),console.log(t),t.token&&t.camid&&t.access&&""!==t.token&&""!==t.camid&&""!==t.access&&(r.sharedKey=t.token,r.mCameraID=t.camid),t.svcp&&""!=t.svcp&&(r.svcp_url=t.svcp)}catch(n){var o="Invalid access token format";return console.error(o),r.player.showErrorText(o),CloudReturnCode.ERROR_INVALID_SOURCE}return r.player.stop(),null!=r.svcp_url&&(r.conn.ServiceProviderUrl=r.svcp_url),r.conn.open(r.sharedKey),r.conn?(r.cm=new CloudCameraList(r.conn),r.cm.getCamera(r.mCameraID).done(function(e){r.camera=e,r.player.setSource(r.camera),r.player.play()}).fail(function(e){console.log(e),r.player.showErrorText("Channel not found")}),CloudReturnCode.OK):(r.player.showErrorText("Access token invalid"),CloudReturnCode.ERROR_NO_CLOUD_CONNECTION)},r.getSource=function(){return r.sharedKey?r.sharedKey:CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},r.play=function(){return r.camera?(r.player.play(),void 0):CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},r.stop=function(){return r.camera?(r.player.stop(),void 0):CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},r.pause=function(){return r.camera?void 0:CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},r.close=function(){r.player.stop(),r.player.close(),r.player.player.innerHTML="",r.conn.close(),window._CloudPlayerSDK[e]&&delete window._CloudPlayerSDK[e]},r.isPlaying=function(){return r.camera?r.player.isPlaying():CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},r.setPosition=function(e){return r.camera?(r.player.stop(),r.player.setPosition(e),r.player.play(),void 0):CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},r.getPosition=function(){return r.camera?r.player.getPosition():CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},r.showTimeline=function(e){return r.camera?r.timeline?(document.getElementById(r.options.timeline).style.display=e?"block":"hide",!0):(console.error(CloudReturnCode.ERROR_NOT_CONFIGURED.text),null):(console.error(CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED.text),null)},r.getChannelName=function(){return r.camera?r.camera.getName():CloudReturnCode.ERROR_SOURCE_NOT_CONFIGURED},r.setRange=function(e,o){r.player.setRange(e,o),r.timeline&&r.timeline.setRange(e,o)},r.resetRange=function(){r.player.resetRange(),r.timeline&&r.timeline.resetRange()}};